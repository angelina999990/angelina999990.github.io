<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Angelina ZX]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://yoursite.com/"/>
  <updated>2017-10-10T11:56:45.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name><![CDATA[Angelina ZX]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[Javascript æ—¶é—´æ—¶åŒºå¤§æ‚çƒ©]]></title>
    <link href="http://yoursite.com/2017/10/10/JStimezone/"/>
    <id>http://yoursite.com/2017/10/10/JStimezone/</id>
    <published>2017-10-10T11:25:49.000Z</published>
    <updated>2017-10-10T11:56:45.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>Read not to contridict and confute; nor to believe and take for granted; nor to find talk and discourse; but to weigh and consider.</p>
</blockquote>
<p>ä»¥å‰ä»æ¥æ²¡æœ‰è®¤çœŸé’»ç ”è¿‡JSä¸­Dateçš„æ—¶é—´æ—¶åŒºç»†èŠ‚ï¼Œå› ä¸ºå·¥ä½œä¸­é‡åˆ°äº†å‰ç«¯é¡µé¢è®¾ç½®æ—¶é—´ï¼Œå®é™…ä¿å­˜æ—©ï¼æ™šäº†ä¸€å¤©çš„æƒ…å†µï¼Œä¸“é—¨èŠ±æ—¶é—´å­¦ä¹ äº†ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œè°¨ä»¥æ­¤æ–‡ä½œå­¦ä¹ ç¬”è®°ã€‚</p>
<h2 id="GMT_&amp;_UTC">GMT &amp; UTC</h2><ul>
<li>GMT (æ ¼æ—å¨æ²»æ—¶é—´) - æ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´çš„æ­£åˆæ˜¯æŒ‡å½“å¤ªé˜³æ¨ªç©¿æ ¼æ—å¨æ²»å­åˆçº¿æ—¶ï¼ˆä¹Ÿå°±æ˜¯åœ¨æ ¼æ—å¨æ²»ä¸Šç©ºæœ€é«˜ç‚¹æ—¶ï¼‰çš„æ—¶é—´ã€‚</li>
<li>UTC (åè°ƒä¸–ç•Œæ—¶) - æ˜¯æœ€ä¸»è¦çš„ä¸–ç•Œæ™‚é–“æ¨™æº–ï¼Œå…¶ä»¥åŸå­æ—¶ç§’é•¿ä¸ºåŸºç¡€ï¼Œåœ¨æ—¶åˆ»ä¸Šå°½é‡æ¥è¿‘äºæ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ã€‚</li>
</ul>
<p>ä»¥ä¸Šä¿¡æ¯æœ‰å…´è¶£å¯ä»¥å»ç»´åŸºç™¾ç§‘æŸ¥çœ‹è¯¦æƒ…ï¼Œçœ‹ä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œåªéœ€è¦è®°ä½ï¼šä¸¤ä¸ªéƒ½æ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œç”±äºGMTæœ¬èº«å­˜åœ¨è¯¯å·®ï¼Œç°åœ¨çš„æ ‡å‡†æ—¶é—´ç”±UTCå†³å®šã€‚</p>
<h2 id="æ—¶é—´è¡¨ç¤ºæ³•_-_ISO_8601">æ—¶é—´è¡¨ç¤ºæ³• - ISO 8601</h2><p>å›½é™…æ ‡å‡†ISO 8601ï¼Œæ˜¯å›½é™…æ ‡å‡†åŒ–ç»„ç»‡çš„æ—¥æœŸå’Œæ—¶é—´çš„è¡¨ç¤ºæ–¹æ³•ã€‚ æ ¼å¼ï¼š<code>YYYY-MM-DDThh24:mm:ssZ</code> (eg. <code>2017-08-24T08:45Z</code>)ã€‚æ—¥æœŸæ—¶é—´åˆå¹¶è¡¨ç¤ºæ—¶ï¼Œè¦åœ¨æ—¶é—´å‰é¢åŠ ä¸€å¤§å†™å­—æ¯Tã€‚å¦‚æœæ—¶é—´æ˜¯ä»¥ UTC è¡¨ç¤ºï¼Œåˆ™åœ¨æ—¶é—´åé¢ç›´æ¥åŠ ä¸Šä¸€ä¸ªâ€œZâ€ï¼ˆä¸åŠ ç©ºæ ¼ï¼‰ã€‚â€œZâ€æ˜¯ UTC æ—¶é—´ä¸­0æ—¶åŒºçš„æ ‡å¿—ã€‚ä¾‹å¦‚ï¼š â€œ09:30 UTCâ€ -&gt; â€œ09:30Zâ€/â€œ0930Zâ€ã€‚ Date.toJSON æ–¹æ³•è¿”å›çš„å°±æ˜¯è¿™ç§æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p>
<h2 id="Javascriptçš„Dateå¯¹è±¡">Javascriptçš„Dateå¯¹è±¡</h2><p>new Date() è¿”å›çš„æ˜¯ä¸€ä¸ªæœ¬åœ°æ—¶é—´çš„dateå¯¹è±¡ï¼Œ</p>
<pre><code><span class="built_in">var</span> <span class="built_in">date</span> <span class="subst">=</span> <span class="literal">new</span> <span class="built_in">Date</span>(); <span class="comment">// Fri Aug 25 2017 13:11:03 GMT+0800 (CST)</span>
<span class="built_in">var</span> dateStr <span class="subst">=</span> <span class="built_in">date</span><span class="built_in">.</span>toISOString(); <span class="comment">// '2017-08-25T05:11:03.000Z'</span>
</code></pre><p>CSTï¼ˆchina standard timeï¼‰æ˜¯å¤§ä¸­åæ ‡å‡†æ—¶åŒºï¼Œæˆ‘ä»¬çš„æ—¶åŒºæ˜¯åœ¨ä¸œå…«åŒºï¼ŒGMT+0800è¡¨ç¤ºæ ‡å‡†æ—¶é—´åŸºç¡€ä¸ŠåŠ 8å°æ—¶ã€‚<br>dateStræ˜¯date å¯¹è±¡çš„æ ‡å‡†æ—¶é—´è¡¨ç¤ºå½¢å¼ï¼Œâ€Zâ€è¡¨ç¤ºè¿™æ˜¯UTCæ—¶é—´ï¼Œä»â€05:11:03â€ä¹Ÿå¯ä»¥çœ‹å‡ºæ˜¯åœ¨æœ¬åœ°æ—¶é—´çš„åŸºç¡€ä¸Šå‡å»äº†8å°æ—¶ã€‚</p>
<pre><code><span class="keyword">var</span> dt1 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2017-08-25T05:11:03.000Z'</span>); <span class="comment">// Fri Aug 25 2017 13:11:03 GMT+0800 (CST)</span>

<span class="keyword">var</span> dt2 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2017-08-25T05:11:03.000'</span>); <span class="comment">// Fri Aug 25 2017 05:11:03 GMT+0800 (CST)</span>
</code></pre><p>ä¸Šé¢ä¸¤è¡Œä»£ç ä¼ å…¥çš„åˆå§‹æ—¶é—´éƒ½æ˜¯ISO 8601æ ‡å‡†ï¼ŒåŒºåˆ«åœ¨äºä¸€ä¸ªæ˜¯UTCæ—¶é—´ï¼Œä¸€ä¸ªæ˜¯æœ¬åœ°æ—¶é—´ï¼ˆæ²¡æœ‰â€Zâ€)ã€‚å¦‚æœä¼ å…¥çš„æ˜¯UTCæ—¶é—´ï¼Œé‚£ä¹ˆnew Dateæœ€åè¿”å›çš„æ˜¯ä¸€ä¸ªè½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´çš„dateå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åœ¨æˆ‘ä»¬ä¼ å…¥çš„åˆå§‹æ—¥æœŸä¸Š+8å°æ—¶åçš„æ—¥æœŸå¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰â€Zâ€æ ‡è¯†ï¼Œç³»ç»Ÿé»˜è®¤è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ—¶é—´ï¼Œè¿”å›çš„dateå¯¹è±¡ä¸å†è½¬æ¢ã€‚<strong>ç®€è€Œè¨€ä¹‹ï¼Œnew Dateæ—¶ä¼ å…¥UTCæ—¶é—´ï¼Œå¾—åˆ°+8å°æ—¶åçš„æ—¶é—´ï¼Œä¼ å…¥æ™®é€šæ—¶é—´å­—ç¬¦ä¸²ï¼Œå¾—åˆ°æ—¶é—´ä¸€è‡´çš„dateå¯¹è±¡</strong>ã€‚</p>
<p>ä»¥ä¸‹ä¸¤è¡Œä»£ç çš„æ•ˆæœå’Œä¸Šé¢å¯¹åº”ä»£ç å…·æœ‰ç›¸åŒæ•ˆæœï¼š</p>
<pre><code><span class="keyword">var</span> dt1 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'Fri Aug 25 2017 05:11:03 UTC'</span>); <span class="comment">// ç”³æ˜äº†æ—¶åŒºï¼ˆUTCï¼‰ï¼Œ è¿”å›+8å°æ—¶åçš„dateå¯¹åƒ</span>
<span class="keyword">var</span> dt2 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'Fri Aug 25 2017 13:11:03'</span>); <span class="comment">// æ²¡æœ‰ç”³æ˜æ—¶åŒºï¼Œè¿”å›ä¸ä¼ å…¥æ—¶é—´ä¸€è‡´çš„dateå¯¹è±¡</span>
</code></pre><h2 id="å‰åç«¯äº¤äº’">å‰åç«¯äº¤äº’</h2><p>ç»å¸¸é‡åˆ°çš„ä¸€ç§äº¤äº’åœºæ™¯ï¼š ç”¨æˆ·åœ¨ä¸€ä¸ªè¯¦æƒ…é¡µé¢è®¾ç½®ä¸€ä¸ªå¸¦æ—¥æœŸæ—¶é—´ä¿å­˜åˆ°æ•°æ®åº“ï¼Œä¸‹æ¬¡åŠ è½½é¡µé¢çš„æ—¶å€™æ˜¾ç¤ºå·²æœ‰çš„æ—¥æœŸã€‚<br>æ•°æ®åº“æ—¥æœŸç›¸å…³çš„æ•°æ®ç±»å‹æœ‰å¤šä¸ªï¼Œæœ‰çš„å¸¦æ—¶åŒºï¼Œæœ‰çš„ä¸å¸¦ã€‚å¦‚æœåœ¨äº¤äº’æ—¶ï¼Œå‰åç«¯å¯¹æ—¶åŒºçš„å¤„ç†ä¸ä¸€è‡´ï¼Œå°±å¯èƒ½é€ æˆæœ€ç»ˆæ˜¾ç¤ºçš„æ—¶é—´ä¸ç”¨æˆ·å®é™…é€‰æ‹©çš„æ—¶é—´ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸¾ä¾‹è¯´æ˜ï¼š</p>
<pre><code><span class="comment">// ç”¨æˆ·å®é™…é€‰æ‹©çš„æ—¶é—´æ˜¯ï¼š 2017-08-25</span>
<span class="comment">// date object : Fri Aug 25 2017 07:00:00 GMT+0800</span>
<span class="comment">// save data</span>
<span class="variable">$http.put</span>(apiUrl, {time: <span class="string">'2017-08-24T23:00:00.000Z'</span>})<span class="built_in">.</span>then(()<span class="subst">=&gt;</span> <span class="string">'success!'</span>);

<span class="comment">// get page detail</span>
<span class="variable">$http.get</span>(<span class="string">'apiUrl'</span>)<span class="built_in">.</span>then( <span class="built_in">data</span> <span class="subst">=&gt;</span> {
  console<span class="built_in">.</span><span class="keyword">log</span>(<span class="built_in">data</span>);   <span class="comment">// {time: '2017-08-24T23:00:00.000'}</span>
  this<span class="built_in">.</span><span class="built_in">date</span> <span class="subst">=</span> <span class="literal">new</span> <span class="built_in">Date</span>(<span class="built_in">data</span><span class="built_in">.</span>time)<span class="built_in">.</span>toDateString(); <span class="comment">//</span>
});

<span class="comment">//tpl.html</span>
<span class="subst">&lt;</span>p<span class="subst">&gt;</span> <span class="built_in">date</span>: <span class="subst">\</span>{<span class="subst">\</span>{ <span class="built_in">date</span> <span class="subst">\</span>}<span class="subst">\</span>}; <span class="subst">&lt;</span>/p<span class="subst">&gt;</span> <span class="comment">// date: Fri Aug 24 2017</span>
</code></pre><p>ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæ—¥æœŸï¼Œ æˆ‘å¾—åˆ°ä¸€ä¸ªdateå¯¹è±¡<code>Fri Aug 25 2017 07:00:00 GMT+0800</code>ï¼Œè½¬æ¢ä¸ºJSONæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ï¼Œå®é™…ä¼ ç»™æœåŠ¡ç«¯çš„å€¼æ˜¯â€™2017-08-24T23:00:00.000Zâ€™ã€‚å‡è®¾æ•°æ®åº“å­˜çš„æ˜¯ä¸å¸¦æ—¶åŒºçš„æ—¶é—´ï¼Œ è€Œä¿å­˜å‰æœåŠ¡ç«¯æœªå¯¹è¯¥æ—¶é—´åšç›¸åº”çš„è½¬æ¢ã€‚é‚£é¡µé¢é‡æ–°åŠ è½½æ—¶ï¼Œæ•°æ®åº“è¿”å›çš„æ˜¯ä¸€ä¸ªéUTCæ—¶é—´<code>&#39;2017-08-24T23:00:00.000&#39;</code>ã€‚é¡µé¢æ˜¾ç¤ºçš„å°±ä¼šæ¯”ç”¨æˆ·å®é™…é€‰æ‹©çš„æ—©ä¸€å¤©(å®é™…ï¼š<code>2017.8.25</code>ï¼Œ æ˜¾ç¤ºï¼š<code>2017.8.24</code>)ã€‚</p>
<h4 id="å‚è€ƒ">å‚è€ƒ</h4><ul>
<li>ç»´åŸºç™¾ç§‘</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>Read not to contridict and confute; nor to believe and take for granted; nor to find talk and discourse; but to weigh and co]]>
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æ¸©æ•…è€ŒçŸ¥æ–° - jsäº‹ä»¶æµæœºåˆ¶]]></title>
    <link href="http://yoursite.com/2017/07/12/%E6%B8%A9%E6%95%85%E8%80%8C%E7%9F%A5%E6%96%B0-js%E4%BA%8B%E4%BB%B6%E6%B5%81%E6%9C%BA%E5%88%B6/"/>
    <id>http://yoursite.com/2017/07/12/æ¸©æ•…è€ŒçŸ¥æ–°-jsäº‹ä»¶æµæœºåˆ¶/</id>
    <published>2017-07-12T14:57:15.000Z</published>
    <updated>2017-07-13T13:42:21.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>Trying to understand some people is like trying to pick up turd by the clean end.</p>
</blockquote>
<p>äº‹ä»¶æ˜¯javascriptä¸€ä¸ªè‡³å…³é‡è¦çš„éƒ¨åˆ†ï¼Œé€šè¿‡æ´¾é£ï¼ç›‘å¬äº‹ä»¶ï¼Œå¯ä»¥å®ç°å¾ˆå¤šåŠ¨æ€åŠŸèƒ½ã€‚é€šè¿‡å¯¹äº‹ä»¶æœºåˆ¶çš„é‡æ¸©ï¼Œæ€»æ˜¯èƒ½é‡æ–°åˆ·æ–°ä¸€äº›æ›¾ç»æ¨¡ç³Šçš„çŸ¥è¯†ç‚¹ã€‚ç‰¹åˆ«å†™æ­¤æ–‡ç»™è‡ªå·±åŠ æ·±å°è±¡ï¼Œ å¦‚æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£ï¼</p>
<p>ä»¥ä¸‹æ–‡ç« çš†ä»¥clickäº‹ä»¶ä¸ºä¾‹ï¼š</p>
<h2 id="äº‹ä»¶æµæœºåˆ¶">äº‹ä»¶æµæœºåˆ¶</h2><h3 id="äº‹ä»¶ä¼ é€’è¿‡ç¨‹">äº‹ä»¶ä¼ é€’è¿‡ç¨‹</h3><p>  äº‹ä»¶ä» <em>ç”¨æˆ·è¡Œä¸ºè§¦å‘</em> åˆ° <em>æ‰§è¡Œå®Œæ¯•</em> å…±æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼š æ•è·ï¼ˆ1ï¼‰ - æŠµè¾¾targetå…ƒç´ ï¼ˆ2ï¼‰ - å†’æ³¡ï¼ˆ3ï¼‰ï¼Œç”±äº‹ä»¶å¯¹è±¡çš„eventPhaseå±æ€§æ ‡è¯†ã€‚çœ‹å›¾ï¼š</p>
<a id="more"></a>
<p>  <img src="https://www.w3.org/TR/DOM-Level-3-Events/images/eventflow.svg" alt="https://www.w3.org/TR/DOM-Level-3-Events/images/eventflow.svg"></p>
<p>  å‡è®¾ç”¨æˆ·ç‚¹å‡»äº†ä¸€ä¸ªè¡¨æ ¼çš„å•å…ƒæ ¼ï¼ŒæŒ‰ç…§ä¸Šå›¾åºå·è¡¨æ˜çš„é¡ºåºï¼Œ ç”¨æˆ·ç‚¹å‡»é¼ æ ‡çš„é‚£ä¸€åˆ»å¼€å§‹ç»å†ä¸‰ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>ä»æœ€å¤–å±‚çš„windowåˆ°æœ€å†…å±‚çš„tdå…ƒç´ æŒ‰é¡ºåºä¸€ä¸€æ•è·åˆ°clickäº‹ä»¶ã€‚æ­¤è¿‡ç¨‹event.eventPhase=1ã€‚</p>
<p>å¦‚æœå½“å‰å…ƒç´ ç»‘å®šäº†è¦åœ¨ <em>æ•è·é˜¶æ®µæ‰§è¡Œ</em> çš„ç›‘å¬å‡½æ•°ï¼ˆlistenerï¼‰, ä¼šåœ¨æ­¤è¿‡ç¨‹å¼€å§‹æ‰§è¡Œã€‚ ï¼ˆä»€ä¹ˆæ˜¯ <em>æ•è·é˜¶æ®µæ‰§è¡Œ</em> çš„ç›‘å¬å‡½æ•°ç¨åå†è¯´ï¼‰</p>
</li>
<li><p>äº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ ï¼ˆå¯è¿½æº¯åˆ°çš„æœ€å†…å±‚å…ƒç´ ï¼‰ã€‚æ­¤æ—¶event.eventPhase=2ã€‚</p>
</li>
<li><p>äº‹ä»¶å¼€å§‹å‘ä¸Šå†’æ³¡ã€‚ æ­¤æ—¶event.eventPhase=3ã€‚</p>
<p>å¦‚æœå½“å‰å…ƒç´ ç»‘å®šäº†è¦åœ¨ <em>å†’æ³¡é˜¶æ®µæ‰§è¡Œ</em> çš„ç›‘å¬å‡½æ•°ï¼Œä¼šåœ¨æ­¤è¿‡ç¨‹å¼€å§‹æ‰§è¡Œã€‚</p>
</li>
</ul>
<h3 id="äº‹ä»¶å¯¹è±¡">äº‹ä»¶å¯¹è±¡</h3><p>  è¯´æ˜ä¸¤ä¸ªæ¦‚å¿µï¼š äº‹ä»¶å¯¹è±¡ï¼ˆeventï¼‰çš„ä¸¤ä¸ªå±æ€§ï¼ševent.target å’Œ event.currentTargetã€‚</p>
<ul>
<li><p>event.target æ˜¯æœ€ç»ˆç‚¹å‡»åˆ°çš„DOMå…ƒç´ ï¼Œ åœ¨æ•´ä¸ªäº‹ä»¶ä¼ é€’è¿‡ç¨‹ä¸­ä¸ä¼šå˜åŒ–ã€‚</p>
</li>
<li><p>event.currentTarget æ˜¯ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå½“å‰éå†åˆ°çš„å…ƒç´ ã€‚</p>
<p>`<br>  <table></table></p>
<pre><code><span class="variable">&lt;tbody&gt;</span>
  <span class="variable">&lt;tr&gt;</span>
    <span class="variable">&lt;td&gt;</span> <span class="built_in">table</span> cell <span class="variable">&lt;/td&gt;</span>
  <span class="variable">&lt;/tr&gt;</span>
<span class="variable">&lt;/tbody&gt;</span>
</code></pre><p>  <br>`</p>
<p>å¦‚ä¸Šä»£ç ï¼ˆæ’‡å¼€bodyåŠä»¥ä¸Šçš„å¯¹è±¡ï¼‰ï¼š ç‚¹å‡»table cellåŒºåŸŸï¼Œ <code>currentTarget</code>ä¾æ¬¡æ˜¯ <code>table &gt; tbody &gt; tr &gt; td(eventPhase=2) &gt; tr &gt; tbody &gt; table</code>ï¼Œè€Œ<code>target</code>ä¸€ç›´æ˜¯<code>td</code></p>
</li>
</ul>
<h2 id="ç»‘å®šä¸ç›‘å¬">ç»‘å®šä¸ç›‘å¬</h2><p>  ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜äº‹ä»¶çš„ç»‘å®šå’Œç›‘å¬ï¼Œæ–¹ä¾¿ç†è§£ä¸Šé¢çš„æ¦‚å¿µã€‚</p>
<p>  <img src="https://pcs.baidu.com/rest/2.0/pcs/thumbnail?method=generate&amp;app_id=250528&amp;path=%2Fhexo%20picture%20server%2F20170712.png&amp;quality=90&amp;size=c375_u667" alt="å›¾ä¾‹2"></p>
<pre><code><span class="comment">//example.html</span>
&lt;div id=<span class="string">"d1"</span>&gt;
  &lt;div id=<span class="string">"d2"</span>&gt;
    &lt;div id=<span class="string">"d3"</span>&gt;
      &lt;div id=<span class="string">"d4"</span>&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

<span class="comment">// style.css</span>
#d1 {
  <span class="variable">width</span>: <span class="number">200</span>px;
  <span class="variable">height</span>: <span class="number">200</span>px;
  <span class="built_in">background</span>: aliceblue;
  margin: auto;
  <span class="built_in">text</span>-align: center;
}
#d2 {
  <span class="variable">width</span>: <span class="number">150</span>px;
  <span class="variable">height</span>: <span class="number">150</span>px;
  <span class="built_in">background</span>: antiquewhite;
}
#d3 {
  <span class="variable">height</span>: <span class="number">100</span>px;
  <span class="variable">width</span>: <span class="number">100</span>px;
  <span class="built_in">background</span>: beige;
}
#d4 {
  <span class="variable">width</span>: <span class="number">50</span>px;
  <span class="variable">height</span>: <span class="number">50</span>px;
  <span class="built_in">background</span>: azure;
}

<span class="comment">//example.js</span>
<span class="keyword">for</span>(let elem of document.querySelectorAll(<span class="string">"#d1, #d1 *"</span>)) {
  elem.addEventListener(<span class="string">"click"</span>, e =&gt; console.<span class="built_in">log</span>(`Capturing: ${elem.id}`), <span class="keyword">true</span>);
  elem.addEventListener(<span class="string">"click"</span>, e =&gt; console.<span class="built_in">log</span>(`Bubbling: ${elem.id}`));
}

<span class="comment">//output ï¼ˆç‚¹å‡»d4åŒºåŸŸï¼‰</span>
Capturing: d1
Capturing: d2
Capturing: d3
Capturing: d4
Bubbling: d4
Bubbling: d3
Bubbling: d2
Bubbling: d1
</code></pre><h3 id="ç»‘å®šäº‹ä»¶">ç»‘å®šäº‹ä»¶</h3><p>  æœ‰äº›jsåº“å°è£…äº†è‡ªå·±éƒ½äº‹ä»¶ç»‘å®šå‡½æ•°ï¼Œè¿™é‡Œä¸èµ˜è¿°ï¼Œæœ¬è´¨éƒ½æ˜¯åŸºäºjsåŸç”Ÿéƒ½addEventListeneræ–¹æ³•ã€‚</p>
<p>  addEventListeneræ¥æ”¶3ä¸ªå‡½æ•°ï¼Œå‰ä¸¤ä¸ªåˆ†åˆ«æ˜¯äº‹ä»¶ç±»å‹å’Œç›‘å¬å‡½æ•°ï¼Œä¸å¿…å¤šè¯´ã€‚ æ³¨æ„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š å¯ä»¥æ˜¯Object / Boolean.</p>
<ul>
<li><p>Boolean</p>
<p>true - è¡¨ç¤ºæŒ‡å®šéƒ½ç›‘å¬å‡½æ•°å°†åœ¨äº‹ä»¶ <em>æ•è·é˜¶æ®µ</em> æ‰§è¡Œ<br>false(Default) - è¡¨ç¤ºç›‘å¬å‡½æ•°åœ¨äº‹ä»¶ <em>å†’æ³¡é˜¶æ®µ</em> æ‰§è¡Œ</p>
<p>è¿™ä¸ªå€¼ç›´æ¥å½±å“åˆ°ä¸åŒå…ƒç´ å¯¹åŒä¸€äº‹ä»¶å“åº”çš„ä½œå‡ºå…ˆåé¡ºåº</p>
</li>
<li><p>Object</p>
<pre><code>{
  <span class="attribute">capture</span>: Boolean,
  <span class="attribute">once</span>: Boolean,
  <span class="attribute">passive</span>: Boolean
}
</code></pre><p>è¿™ç§å½¢å¼ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œè¯¦æƒ…å¯å‚è€ƒ<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="external">è¿™é‡Œ</a>ï¼</p>
</li>
</ul>
<h3 id="target">target</h3><p>  åœ¨æ•´ä¸ªäº‹ä»¶ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œ</p>
<p>  å¦‚æœç”¨æˆ·ç‚¹å‡»d4åŒºåŸŸï¼š</p>
<ul>
<li>currentTarget çš„å˜åŒ–ï¼š <code>d1</code> &gt; <code>d2</code> &gt; <code>d3</code> &gt; <code>d4</code> &gt; <code>d4</code> &gt; <code>d3</code> &gt; <code>d2</code> &gt; <code>d1</code>ã€‚</li>
<li><p>targetï¼š <code>d4</code></p>
<p>å¦‚æœç”¨æˆ·ç‚¹å‡»d2ä¸­ä¸è¦†ç›–d3,d4çš„åŒºåŸŸï¼š</p>
</li>
<li><p>currentTarget çš„å˜åŒ–ï¼š <code>d1</code> &gt; <code>d2</code> &gt; <code>d2</code> &gt; <code>d1</code>ã€‚</p>
</li>
<li>targetï¼š <code>d2</code></li>
</ul>
<p>  ä¹Ÿå°±æ˜¯è¯´ï¼š event.targetçš„å€¼å–å†³äºäº‹ä»¶è§¦å‘æ—¶å¯è¿½æº¯åˆ°çš„æœ€å†…å±‚å…ƒç´ ã€‚ ç‚¹å‡»d2ä¸­ä¸è¦†ç›–d3,d4çš„åŒºåŸŸï¼Œd2å°±æ˜¯å½“å‰ç‚¹å‡»äº‹ä»¶çš„æœ€å†…å±‚å…ƒç´ ï¼Œæ‰€ä»¥event.targetæŒ‡å‘d2ã€‚</p>
<h2 id="ç»†ææœ«èŠ‚">ç»†ææœ«èŠ‚</h2><p>eventå¯¹è±¡æœ‰ä¸¤ä¸ªæ–¹æ³• <code>preventDefault</code> å’Œ <code>stopPropergation</code>:</p>
<ul>
<li><p>event.preventDefault() - å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼›</p>
</li>
<li><p>event.stopPropergation() - é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ é€’ï¼›</p>
</li>
</ul>
<p>å…¶ä¸­ï¼Œ <code>preventDefault</code>æ˜¯å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼Œä½†å¹¶ä¸ä¼šé˜»æ­¢äº‹ä»¶çš„ä¼ é€’ï¼Œä¼šç»§ç»­ æ•è· -&gt; æŠµåˆ° -&gt; å†’æ³¡ çš„è¿‡ç¨‹ã€‚ å¦‚ä¸‹ä¾‹ï¼š</p>
<pre><code>&lt;input id=<span class="string">"checkbox"</span> type=<span class="string">'checkbox'</span> value=<span class="keyword">true</span> /&gt;

<span class="comment">// js</span>
<span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'checkbox'</span>);
el.addEventListener(â€˜clickâ€™ï¼Œ e =&gt; e.preventDefault());
</code></pre><p>ç‚¹å‡»è¿™ä¸ªcheckboxçš„æ—¶å€™ï¼Œæ­£å¸¸æƒ…å†µcheckboxåº”è¯¥è¢«å‹¾ä¸Šï¼Œ ä½†è°ƒç”¨äº†<code>preventDefault()</code>æ–¹æ³•ï¼Œå–æ¶ˆäº†è¯¥DOMå…ƒç´ ç‚¹å‡»äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼Œcheckboxå°±ä¸ä¼šå†å‹¾é€‰ä¸Šã€‚</p>
<p><code>stopPropergation</code>æ˜¯é˜»æ­¢äº‹ä»¶ç»§ç»­å¾€åä¼ é€’ã€‚ä¾‹å¦‚ï¼Œ</p>
<pre><code>&lt;input id=<span class="string">"checkbox"</span> type=<span class="string">'checkbox'</span> value=<span class="keyword">true</span> /&gt;

<span class="comment">// js</span>
<span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'checkbox'</span>);
el.addEventListener(<span class="string">'click'</span>ï¼Œ e =&gt; e.stopPropergation(), <span class="keyword">true</span>);
el.addEventListener(<span class="string">'click'</span>ï¼Œ e =&gt; console.log(el.tagName), <span class="keyword">true</span>);
</code></pre><p>ç‚¹å‡»è¿™ä¸ªcheckboxï¼Œç”±äºåœ¨ <em>æ•è·é˜¶æ®µ</em> è°ƒç”¨äº†<code>stopPropergation()</code>, åœ¨æ­¤è¢«æˆªæ–­ï¼Œé˜»æ­¢äº†äº‹ä»¶ç»§ç»­å‘åä¼ é€’ï¼Œæ ¹æœ¬ä¸ä¼šæœ‰åé¢å†’æ³¡çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æœ€åæ ¹æœ¬ä¸ä¼šè¾“å‡ºå…ƒç´ æ ‡ç­¾ã€‚é€šå¸¸å…ƒç´ çš„é»˜è®¤ç‚¹å‡»è¡Œä¸ºæ˜¯åœ¨äº‹ä»¶å†’æ³¡é˜¶æ®µæ‰æ‰§è¡Œï¼Œæ‰€ä»¥è¿™é‡Œè™½ç„¶ç‚¹å‡»äº†checkboxï¼Œä½†ä»ç„¶ä¸ä¼šå‹¾é€‰ä¸Šã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2><ul>
<li><p>äº‹ä»¶ä¼ é€’çš„ä¸‰ä¸ªçŠ¶æ€ï¼š æ•è·(1)ã€æŠµè¾¾ç›®æ ‡(2)ã€å†’æ³¡(3)ï¼Œç”±äº‹ä»¶å¯¹è±¡Eventçš„eventPhaseå±æ€§æ ‡è¯†ï¼›</p>
</li>
<li><p>Event.targetå§‹ç»ˆæŒ‡å‘äº‹ä»¶è§¦å‘æ—¶å¯è¿½æº¯åˆ°çš„æœ€æ·±å±‚å…ƒç´ ï¼›Event.currentTargetæŒ‡äº‹ä»¶ä¼ é€’è¿‡ç¨‹ä¸­å½“å‰éå†åˆ°çš„å…ƒç´ ï¼›</p>
</li>
<li><p>Event.preventDefault() å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼Œä½†ä¸ä¼šé˜»æ­¢ä¼ é€’ï¼› Event.stopPropergation()é˜»æ­¢äº‹ä»¶ç»§ç»­å‘åä¼ é€’ï¼›</p>
</li>
</ul>
<h6 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h6><ul>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="external">EventTarget.addEventListener() - MDN</a></p>
</li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/eventPhase" target="_blank" rel="external">Event.eventPhase - MDN</a></p>
</li>
<li><p><a href="https://www.w3.org/TR/DOM-Level-3-Events/#event-flow" target="_blank" rel="external">DOM Event Architecture</a></p>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>Trying to understand some people is like trying to pick up turd by the clean end.</p>
</blockquote>
<p>äº‹ä»¶æ˜¯javascriptä¸€ä¸ªè‡³å…³é‡è¦çš„éƒ¨åˆ†ï¼Œé€šè¿‡æ´¾é£ï¼ç›‘å¬äº‹ä»¶ï¼Œå¯ä»¥å®ç°å¾ˆå¤šåŠ¨æ€åŠŸèƒ½ã€‚é€šè¿‡å¯¹äº‹ä»¶æœºåˆ¶çš„é‡æ¸©ï¼Œæ€»æ˜¯èƒ½é‡æ–°åˆ·æ–°ä¸€äº›æ›¾ç»æ¨¡ç³Šçš„çŸ¥è¯†ç‚¹ã€‚ç‰¹åˆ«å†™æ­¤æ–‡ç»™è‡ªå·±åŠ æ·±å°è±¡ï¼Œ å¦‚æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£ï¼</p>
<p>ä»¥ä¸‹æ–‡ç« çš†ä»¥clickäº‹ä»¶ä¸ºä¾‹ï¼š</p>
<h2 id="äº‹ä»¶æµæœºåˆ¶">äº‹ä»¶æµæœºåˆ¶</h2><h3 id="äº‹ä»¶ä¼ é€’è¿‡ç¨‹">äº‹ä»¶ä¼ é€’è¿‡ç¨‹</h3><p>  äº‹ä»¶ä» <em>ç”¨æˆ·è¡Œä¸ºè§¦å‘</em> åˆ° <em>æ‰§è¡Œå®Œæ¯•</em> å…±æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼š æ•è·ï¼ˆ1ï¼‰ - æŠµè¾¾targetå…ƒç´ ï¼ˆ2ï¼‰ - å†’æ³¡ï¼ˆ3ï¼‰ï¼Œç”±äº‹ä»¶å¯¹è±¡çš„eventPhaseå±æ€§æ ‡è¯†ã€‚çœ‹å›¾ï¼š</p>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æµ…è°ˆjavascriptä¸­çš„åŸå‹å’Œç»§æ‰¿]]></title>
    <link href="http://yoursite.com/2017/02/16/%E6%B5%85%E8%B0%88javascript%E4%B8%AD%E7%9A%84%E5%8E%9F%E5%9E%8B%E5%92%8C%E7%BB%A7%E6%89%BF/"/>
    <id>http://yoursite.com/2017/02/16/æµ…è°ˆjavascriptä¸­çš„åŸå‹å’Œç»§æ‰¿/</id>
    <published>2017-02-16T07:20:51.000Z</published>
    <updated>2017-02-16T08:58:00.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>How to travel in time? read. How to feel time? Write.</p>
</blockquote>
<p>å‰å‡ å¤©ä»”ç»†çš„çœ‹äº†çœ‹javascriptçš„åŸå‹æ¨¡å¼å’ŒåŸºäºåŸå‹çš„ç»§æ‰¿ï¼Œ ä»Šå¤©å°±å¯¹å…¶ä½œä¸€ä¸ªç®€å•çš„æ€»ç»“ä½œä¸ºè¯»ä¹¦ç¬”è®°ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯åŸå‹">ä»€ä¹ˆæ˜¯åŸå‹</h2><p>è¯´åŸå‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´è¯´å‡½æ•°å§ã€‚<br><a id="more"></a></p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">Person</span><span class="params">()</span> </span>{
}

Person.prototype.name = <span class="string">'Scofiled'</span>;
Person.prototype.age = <span class="number">29</span>;
Person.prottype.sayName = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
 <span class="keyword">return</span> <span class="keyword">this</span>.name;
}

<span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();
person1.sayName(); <span class="comment">// 'Scofield'</span>
alert(person1.age); <span class="comment">//29</span>

<span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();
person2.sayName(); <span class="comment">// 'Scofield'</span>
alert(person2.age); <span class="comment">//29</span>
</code></pre><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>Person</code>çš„å‡½æ•°ï¼Œç„¶ååœ¨åœ¨å®ƒçš„<code>prototype</code>å±æ€§ä¸Šåˆæ·»åŠ äº†å¦‚ä¸Šå‡ ä¸ªå±æ€§ã€‚ ç„¶ååˆ›å»ºäº†<code>Person</code>çš„ä¸¤ä¸ªå®ä¾‹ã€‚<br>è¿™ä¸ª<code>prototype</code> æ˜¯å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ <strong>æˆ‘ä»¬æ¯åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œ å°±ä¼šè‡ªåŠ¨ä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ª<code>prototype</code>å±æ€§ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯åŸå‹å¯¹è±¡</strong>ã€‚<br>åŸå‹å¯¹è±¡æ˜¯æ‹¿æ¥å¹²å˜›çš„ï¼Ÿå¦‚ä¸Šé¢ä»£ç æ˜¾ç¤ºçš„ï¼Œ<code>person1</code> å’Œ<code>person2</code>éƒ½æ˜¯<code>Person</code>çš„å®ä¾‹ï¼Œ è¿™ä¸¤ä¸ªå®ä¾‹éƒ½å…·æœ‰äº†<code>Person.prototype</code>ä¸Šå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>åŸå‹å¯¹è±¡çš„ç”¨é€”å°±æ˜¯è®©æŸç‰¹å®šç±»å‹ï¼ˆå¦‚ï¼š<code>Person</code>ï¼‰çš„æ‰€æœ‰å®ä¾‹ï¼ˆå¦‚ï¼š<code>person1</code>å’Œ<code>person2</code>ï¼‰èƒ½å…±äº«ä¸€äº›å±æ€§å’Œæ–¹æ³•</strong>ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„name,ageå’ŒsayName()éƒ½æ˜¯åŸå‹å¯¹è±¡ä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶éå®ä¾‹æœ¬èº«æ‰€æœ‰ã€‚åœ¨è°ƒç”¨æ„é€ å‡½æ•°ï¼ˆ<code>Person</code>ï¼‰åˆ›å»ºå®ä¾‹ï¼ˆ<code>person1</code>å’Œ<code>person2</code>ï¼‰åï¼Œå®ä¾‹å†…éƒ¨å°†åŒ…å«ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆ<code>Person.prototype</code>ï¼‰ã€‚ ä¸¾ä¸ªåˆ—å­ï¼Œè¯»å–<code>person1.age</code>æ—¶<code>person1</code>æœ¬èº«æ˜¯æ²¡æœ‰ageè¿™ä¸ªå±æ€§çš„, ä½†æ˜¯ç¨‹åºä¼šåœ¨è¯»å–å±æ€§æ—¶æ‰§è¡Œä¸€æ¬¡æœç´¢ï¼Œä»å®ä¾‹æœ¬èº«å¼€å§‹ï¼Œæ‰¾åˆ°ç›®æ ‡åˆ™åœæ­¢ï¼Œå¦åˆ™ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾åŸå‹å¯¹è±¡ã€‚æ‰€ä»¥<code>person1.age</code>çš„å€¼å…¶å®æ˜¯åœ¨æŸ¥æ‰¾åŸå‹å¯¹è±¡æ—¶è¿”å›çš„ã€‚</p>
<h2 id="åŸå‹é“¾å’Œç»§æ‰¿">åŸå‹é“¾å’Œç»§æ‰¿</h2><p>è¯´å®ŒåŸå‹ï¼Œå°±æ¥è¯´ç»§æ‰¿ã€‚ ç»§æ‰¿çš„å®ç°ä¸»è¦æ˜¯é€šè¿‡åŸå‹é“¾ã€‚ ä¸Šé¢å¤§æ¦‚ç†äº†ä¸€ä¸‹åŸå‹å’Œå®ä¾‹çš„å…³ç³»ï¼Œ <code>person1</code>çš„æŒ‡é’ˆæ˜¯æŒ‡å‘åŸå‹å¯¹è±¡<code>Person.prototype</code>çš„ï¼Œ<code>Person.prototype</code>æ˜¯åœ¨å®šä¹‰<code>Person</code>æ—¶è‡ªåŠ¨åˆ›å»ºå¹¶æœ‰æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ äº†ä¸€äº›å±æ€§å’Œæ–¹æ³•ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœPerson.prototypeæŒ‡å‘çš„æ˜¯å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ä¼šæ€æ ·ã€‚</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">superPerson</span><span class="params">()</span> </span>{
  <span class="keyword">this</span>.superProperty = <span class="string">'super'</span>;
}

SuperPerson.prototype.superName = <span class="string">'protoSuper'</span>;
SuperPerson.prototype.getSuperName = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">return</span> <span class="keyword">this</span>.superName;
}

<span class="function"><span class="keyword">function</span> <span class="title">Person</span><span class="params">()</span> </span>{
  <span class="keyword">this</span>.personProperty = <span class="string">'person'</span>;
}

Person.prototype = <span class="keyword">new</span> SuperPerson(); <span class="comment">// {superProperty: 'super'}</span>

<span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(); <span class="comment">// {personProperty: 'person'}</span>

person1.getSuperName(); <span class="comment">// 'protoSuper'</span>
alert(person1.superProperty); <span class="comment">// 'super'</span>
alert(person1.personProperty); <span class="comment">// 'person'</span>
</code></pre><p>å¦‚ä¸Šï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>SuperPerson</code>ç±»å‹ã€‚åœ¨å®šä¹‰Personåæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>SuperPerson</code>å®ä¾‹å¹¶å°†å…¶èµ‹å€¼ç»™<code>Person.prototype</code>ã€‚ä¸Šé¢è®²åŸå‹æ—¶æåˆ°è¿‡ï¼Œåœ¨è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹åï¼Œå®ä¾‹å†…éƒ¨å°†åŒ…å«ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œ <code>new SuperPerson()</code> å¾—åˆ°çš„å®ä¾‹å¯¹è±¡å†…éƒ¨ä¹ŸåŒ…å«ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘<code>SuperPerson</code>çš„åŸå‹å¯¹è±¡ï¼ˆå³<code>SuperPerson.prototype</code>ï¼‰ï¼Œå½“ç„¶ä¹Ÿä¼šç»§æ‰¿<code>SuperPerson.prototype</code>ä¸ŠåŒ…å«çš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<p>åœ¨è¯»å– <code>person1.getSuperName</code> æ–¹æ³•æ—¶æ‰§è¡Œäº†3æ¬¡æœç´¢ï¼Œç¬¬1æ¬¡<code>person1</code>æœ¬èº«ï¼Œæ²¡æœ‰æ‰¾åˆ°ç›®æ ‡ï¼› ç¬¬2æ¬¡ä¾¿æ ¹æ®<code>person1</code>å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„åŸå‹å¯¹è±¡ï¼ˆPerson.prototypeï¼‰å»æŸ¥æ‰¾ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼›ç¬¬3æ¬¡æ ¹æ®<code>Person.prototype</code>å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„åŸå‹ï¼ˆ<code>SuperPerson.prototype</code>ï¼‰æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç›®æ ‡ã€‚</p>
<p>åœ¨è¯»å– <code>person1.superProperty</code>æ—¶æ‰§è¡Œäº†ä¸¤æ¬¡æŸ¥æ‰¾ï¼Œç¬¬1æ¬¡ä»ç„¶æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œç¬¬2æ¬¡æŸ¥æ‰¾<code>Person.prototype</code>æ—¶ï¼Œç”±äº<code>Person.prototype</code>æ˜¯<code>SuperPerson</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥<code>Person.prototype</code>æ˜¯å…·æœ‰<code>superProperty</code>å±æ€§çš„ã€‚æ‰€ä»¥æˆåŠŸåœ¨<code>Person</code>çš„åŸå‹å¯¹è±¡ä¸Šæ‰¾åˆ°ã€‚</p>
<p>åŒæ ·çš„<code>person1</code>æ˜¯<code>Person</code>çš„å®ä¾‹ï¼Œæ‰€ä»¥<code>person1</code>æœ¬èº«æ˜¯å…·æœ‰<code>personProperty</code>è¿™ä¸ªå±æ€§çš„ã€‚æ‰€ä»¥è¯»å–<code>person1.personProperty</code>æ—¶åªæ‰§è¡Œäº†ä¸€æ¬¡æœç´¢ã€‚</p>
<p>å¦‚ä¸Šé¢è¿™ç§ä¸€ä¸ªåŸå‹åˆæ˜¯å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œè¿™æ ·å±‚å±‚é€’è¿›ï¼Œå°±æ„æˆäº†å®åŠ›ä¸åŸå‹çš„é“¾æ¡ï¼Œå°±æ˜¯ä½œä¸ºçš„<strong>åŸå‹é“¾</strong>ã€‚ä»¿é€ ç€è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®éœ€è¦ç»™è¿™æ¡åŸå‹é“¾çš„å¤´å°¾ç»§ç»­å¢åŠ å…¶ä»–ç±»å‹ï¼Œæ¥å®ç°å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ã€‚</p>
<p>è¿™é‡Œåªæ˜¯ç®€å•çš„è¯´äº†è¯´åŸå‹å’Œç»§æ‰¿çš„æ¦‚å¿µï¼Œå…¶ä¸­å½“ç„¶è¿˜æ¶‰åŠäº†æ›´ä¸ºå¤æ‚çš„é—®é¢˜ï¼Œè¿˜æ˜¯ç•™ç€ä¸‹ä¸€æ¬¡å†ç»†è¯´å§ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>How to travel in time? read. How to feel time? Write.</p>
</blockquote>
<p>å‰å‡ å¤©ä»”ç»†çš„çœ‹äº†çœ‹javascriptçš„åŸå‹æ¨¡å¼å’ŒåŸºäºåŸå‹çš„ç»§æ‰¿ï¼Œ ä»Šå¤©å°±å¯¹å…¶ä½œä¸€ä¸ªç®€å•çš„æ€»ç»“ä½œä¸ºè¯»ä¹¦ç¬”è®°ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯åŸå‹">ä»€ä¹ˆæ˜¯åŸå‹</h2><p>è¯´åŸå‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´è¯´å‡½æ•°å§ã€‚<br>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ç†è§£javascript thiså…³é”®å­—çš„åœ¨ä¸åŒæƒ…å†µä¸‹çš„è¡¨ç°]]></title>
    <link href="http://yoursite.com/2016/08/25/understanding-javascript-this/"/>
    <id>http://yoursite.com/2016/08/25/understanding-javascript-this/</id>
    <published>2016-08-25T03:26:26.000Z</published>
    <updated>2016-08-25T03:32:24.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>The best time for new beginnings is now</p>
</blockquote>
<p>thisçš„æŒ‡å‘é—®é¢˜åœ¨javascriptä¸­ä¸€ç›´æ¯”è¾ƒå›°æ‰°æˆ‘ã€‚ ä¸€ä¸‹æ€»ç»“äº†å‡ ç§æƒ…å†µä¸‹thisåˆ†åˆ«æŒ‡å‘çš„å†…å®¹ã€‚ æ€»çš„æ¥è¯´å°±æ˜¯æ ¹æ®æ‰§è¡Œç¯å¢ƒæˆ–å‡½æ•°çš„æ‰§è¡Œæ–¹å¼ä¸åŒï¼Œthisçš„å€¼æœ‰æ‰€ä¸åŒã€‚<br>è¿™é‡Œå‡è®¾æ‰§è¡Œç¯å¢ƒæ˜¯åœ¨æµè§ˆå™¨ç«¯ï¼Œæ‰€æœ‰çš„å…¨å±€å¯¹è±¡éƒ½æ˜¯æŒ‡windowå¯¹è±¡</p>
<a id="more"></a>
<h2 id="å®šä¹‰åœ¨å…¨å±€æ¨¡å¼ä¸‹">å®šä¹‰åœ¨å…¨å±€æ¨¡å¼ä¸‹</h2><pre><code>{
    <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="regexp">//</span><span class="literal">true</span>; æœªå®šä¹‰ä»»ä½•å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œ<span class="keyword">this</span> æŒ‡å‘<span class="built_in">window</span>
}
</code></pre><h2 id="å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨">å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨</h2><p>æ ¹æ®å‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸åŒï¼Œthisçš„å€¼å¯èƒ½ä¸åŒ</p>
<h3 id="æ™®é€šè°ƒç”¨">æ™®é€šè°ƒç”¨</h3><pre><code>{
    a = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
        <span class="keyword">return</span> <span class="keyword">this</span>;
    }

    b = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
<span class="pi">        "use strict"</span>
        <span class="keyword">return</span> <span class="keyword">this</span>;
    }

    a(); <span class="comment">// éä¸¥æ ¼æ¨¡å¼ï¼š thisæŒ‡å‘å…¨å±€å¯¹è±¡</span>
    b(); <span class="comment">// ä¸¥æ ¼æ¨¡å¼ï¼š this = undefine;</span>
}
</code></pre><h3 id="å¯¹è±¡å†…éƒ¨è°ƒç”¨">å¯¹è±¡å†…éƒ¨è°ƒç”¨</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯thisçš„æŒ‡å‘æ€»æ˜¯ä¸ä»–æœ€è¿‘çš„æ‰§è¡Œç¯å¢ƒç›¸å…³ã€‚ çœ‹ä¸‹é¢çš„åˆ—å­ï¼š</p>
<pre><code>{
    o = {
        a: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
            <span class="keyword">return</span> <span class="keyword">this</span>;
        },

        b: {
            c: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
                <span class="keyword">return</span> <span class="keyword">this</span>;
            }
        }
    };

    o.a(); <span class="comment">//ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨ï¼Œ thisæŒ‡å‘è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æœ¬èº«ï¼Œå³o</span>

    o.b.c(); <span class="comment">// cæ˜¯ä½œä¸ºo.bè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥cè¿”å›çš„thisæ˜¯æŒ‡å‘o.bè¿™ä¸ªå¯¹è±¡çš„</span>


    <span class="comment">//å†çœ‹ä¸‹é¢çš„ä¾‹å­</span>

    d = o.b.c;
    d(); <span class="comment">// dæ˜¯åœ¨å…¨å±€ç¯å¢ƒä¸‹è°ƒç”¨çš„ï¼Œæ‰€ä»¥è¿”å›çš„thisæ˜¯æŒ‡å‘windowå¯¹è±¡çš„</span>
}
</code></pre><p>ä½†æ˜¯å¦‚æœæ˜¯arrow function å®šä¹‰çš„å‡½æ•°ï¼Œ å…¶thisä¼šè¢«ç»‘å®šåˆ°è¯¥å‡½æ•°å¤–å±‚æ‰§è¡Œç¯å¢ƒçš„thisä¸Šï¼Œ çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code>{
    x = <span class="number">10</span>;
    o2 = {

        <span class="attribute">x</span>: <span class="keyword">this</span>.x, <span class="regexp">//</span> æ­¤æ—¶çš„<span class="keyword">this</span>æ˜¯æŒ‡å‘<span class="built_in">window</span>å¯¹è±¡çš„

        <span class="attribute">e</span>: <span class="function"><span class="params">( () =&gt; <span class="keyword">this</span>)</span>,

        f: function<span class="params">()</span> {
            var g = (<span class="params">()</span> =&gt;</span> {
                <span class="built_in">console</span>.log(<span class="keyword">this</span>.e());
                <span class="keyword">return</span> <span class="keyword">this</span>;
            });
            <span class="keyword">return</span> g();
        }
    };

    o2.e(); <span class="regexp">//</span><span class="built_in">window</span>
    o2.f(); <span class="regexp">//</span>Object{}
}
</code></pre><p>æ‰§è¡Œo2.e()è¿”å›windowå¯¹è±¡ã€‚å› ä¸ºeçš„å¤–å±‚æ˜¯o2, o2çš„thisæŒ‡å‘Globalï¼Œæ‰€ä»¥e() è¿”å›çš„this æ˜¯windowå¯¹è±¡ã€‚</p>
<p>o2.f å†…éƒ¨åˆå®šä¹‰äº†g å‡½æ•°ã€‚è¯¥å‡½æ•°éªŒè¯äº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>g æœ¬èº«çš„thisæŒ‡å‘ï¼›</li>
<li>ä¸åŒç¯å¢ƒä¸‹è°ƒç”¨e(), å…¶thisè¿”å›å€¼ä¼šä¸ä¼šå˜åŒ–ï¼›</li>
</ol>
<p>å› ä¸ºgçš„å¤–å±‚æ˜¯få‡½æ•°ï¼Œfçš„thisæ˜¯æŒ‡å‘o2å¯¹è±¡æœ¬èº«çš„ã€‚æ‰€ä»¥g()è¿”å›çš„thisæ˜¯o2å¯¹è±¡æœ¬èº«ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œå¦‚æœ <code>console.log(this.e())</code> æ‰èƒ½å¤ŸæˆåŠŸè°ƒç”¨e(), å¦‚æœthisä¸æ˜¯æ‰§è¡Œo2, é‚£ä¹ˆ <code>console.log(this.e())</code> å°±ä¼šæŠ¥ <code>Uncaught TypeError: this.e is not a function(â€¦)</code>ã€‚ å¦å¤–this.e()çš„è¿”å›ç»“æœä»ç„¶æ˜¯windowå¯¹è±¡ï¼Œè¿™å°±è¯´æ˜äº†arrow function çš„å¦ä¸€ä¸ªç‰¹æ€§ï¼Œarrow function çš„thisåœ¨åˆ›å»ºçš„æ—¶å€™å°±æŒ‡å®šäº†(å³å…¶å¤–å±‚æ‰§è¡Œç¯å¢ƒçš„thisä¸Š)ã€‚å½“ç„¶å¦‚æœå¯ä»¥æŒ‡å®šå…¶å¤–å±‚æ‰§è¡Œç¯å¢ƒï¼Œé‚£å°±å¦å½“åˆ«è®ºäº†ã€‚</p>
<pre><code><span class="collection">{
    // è¿™é‡Œä¿®æ”¹ä¸€ä¸‹o2.f
    o2.f = function<span class="list">()</span> <span class="collection">{
        var g = <span class="list">(<span class="list">()</span> =&gt; <span class="collection">{
            return this;
        }</span>)</span><span class="comment">;</span>
        return g<span class="list">()</span><span class="comment">;</span>
    }</span><span class="comment">;</span>

    o3 = <span class="collection">{}</span><span class="comment">;</span>

    o2.f.apply<span class="list">(<span class="keyword">o3</span>)</span><span class="comment">;</span>
}</span>
</code></pre><p>è¿™é‡Œé€šè¿‡apply è°ƒç”¨o2.f, ä½¿of.fçš„thisæŒ‡å‘o3, è¿™æ ·ä¸€æ¥g()è¿”å›çš„thiså°±æŒ‡å‘äº†o3 æœ¬èº«ã€‚ å»æ‰ <code>console.log(this.e());</code>è¿™è¡Œä»£ç çš„åŸå› å°±æ˜¯ä¸ºäº†é¿å…æŠ¥<code>Uncaught TypeError: this.e is not a function(â€¦)</code>é”™è¯¯ï¼ˆå› ä¸ºo3ä¸Šæ²¡æœ‰å®šä¹‰eè¿™ä¸ªå‡½æ•°ï¼‰;</p>
<h3 id="é€šè¿‡newè°ƒç”¨">é€šè¿‡newè°ƒç”¨</h3><p>é€šè¿‡newè°ƒç”¨çš„å‡½æ•°ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°è¢«æ‰§è¡Œå»åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„å®ä¾‹å¯¹è±¡ã€‚å®ƒä¸»è¦åšäº†3ä»¶äº‹:</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç»§æ‰¿å…¶æ„é€ å‡½æ•°çš„åŸå‹é“¾ï¼›</li>
<li>æ‰§è¡Œè¯¥æ„é€ å‡½æ•°å¹¶æŠŠthisç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šï¼›</li>
<li><p>å¦‚æœæ„é€ å‡½æ•°æœ‰è¿”å›å¯¹è±¡åˆ™å°†åˆšè¿”å›å¯¹è±¡ä½œä¸ºnewè¡¨è¾¾å¼çš„æ‰§è¡Œç»“æœï¼ˆï¼‰ï¼Œå¦‚æœæœªè¿”å›å¯¹è±¡ï¼Œåˆ™å°†ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡ä½œä¸ºæœ€ç»ˆç»“æœã€‚</p>
<p> {</p>
<pre><code><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span><span class="params">(a, b)</span> </span>{
    <span class="keyword">this</span>.name = a || <span class="string">""</span>;
    <span class="keyword">this</span>.age = b || <span class="string">""</span>;
};

<span class="keyword">var</span> AnotherPerson = <span class="function"><span class="keyword">function</span><span class="params">(a,b)</span> </span>{
    <span class="keyword">this</span>.name = a || <span class="string">""</span>;
    <span class="keyword">this</span>.age = b || <span class="string">""</span>;
    <span class="keyword">return</span> {name: <span class="string">"Simpson"</span>};
};

p1 = <span class="keyword">new</span> Person(<span class="string">"Jane"</span>, <span class="number">22</span>); <span class="comment">// {name: "Jane", age: "22"};</span>
p2 = <span class="keyword">new</span> AnotherPerson(<span class="string">"Jane"</span>, <span class="number">22</span>); <span class="comment">// {name: "Simpson"};</span>
</code></pre><p> }</p>
</li>
</ol>
<p>åƒä¸Šé¢çš„ä¾‹å­ï¼Œthiså§‹ç»ˆæ˜¯æŒ‡å‘ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡ï¼Œå½“æ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡æ—¶ï¼Œp1å¾—åˆ°çš„ç»“æœå³æ˜¯ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡è¢«èµ‹å€¼åçš„ç»“æœã€‚ å½“æ„é€ å‡½æ•°å…·æœ‰è¿”å›å¯¹è±¡æ—¶ï¼Œ <code>this.name = a || &quot;&quot;; this.age = b || &quot;&quot;;</code>å…¶å®ä¹Ÿæ‰§è¡Œäº†ï¼Œç¬¬ä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡å…¶å®ä¹Ÿè¢«èµ‹å€¼äº†ï¼Œåªæ˜¯æœ€ç»ˆç»“æœè¢«å…¶è¿”å›å€¼è¦†ç›–äº†ã€‚</p>
<h3 id="é€šè¿‡call,_applyè°ƒç”¨">é€šè¿‡call, applyè°ƒç”¨</h3><p>å‰é¢çš„ä¾‹å­å·²ç»æåˆ°è¿‡ï¼Œé€šè¿‡applyå¯ä»¥æŒ‡å®šfunctionå†…éƒ¨çš„thisæŒ‡å‘ä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡ï¼Œé€šè¿‡callæ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåªéœ€å°†ç‰¹å®šçš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œå‡½æ•°å†…éƒ¨çš„thiså°±ä¼šæŒ‡å®šåˆ°è¿™ä¸ªç‰¹å®šçš„å¯¹è±¡ä¸Šã€‚</p>
<pre><code>{

    <span class="keyword">var</span> k = 1;

    function <span class="literal">j</span>() {
        <span class="keyword">return</span> this.k;
    }

    <span class="keyword">var</span> <span class="keyword">l</span> = {
        k: 10
    };

    <span class="literal">j</span>(); <span class="comment">// 1;  thisæŒ‡å‘windowå¯¹è±¡</span>
    j.apply(<span class="keyword">l</span>); <span class="comment">//10</span>
    j.call(<span class="keyword">l</span>); <span class="comment">//10</span>
}
</code></pre><h3 id="é€šè¿‡bindæŒ‡å®šå¯¹è±¡è°ƒç”¨å‡½æ•°">é€šè¿‡bindæŒ‡å®šå¯¹è±¡è°ƒç”¨å‡½æ•°</h3><p>bindå’Œcall,applyçš„ä½œç”¨ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†functionå†…éƒ¨çš„thisç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡ä¸Šã€‚</p>
<pre><code>{

    <span class="keyword">var</span> k = 1;
    function <span class="literal">j</span>() {
        <span class="keyword">return</span> this.k;
    }

    <span class="keyword">var</span> <span class="keyword">l</span> = {
        k: 10
    };

    <span class="keyword">m</span> = j.bind(<span class="keyword">l</span>);

    <span class="literal">j</span>(); <span class="comment">// 1</span>
    <span class="literal">m</span>(); <span class="comment">// 10</span>
}
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>The best time for new beginnings is now</p>
</blockquote>
<p>thisçš„æŒ‡å‘é—®é¢˜åœ¨javascriptä¸­ä¸€ç›´æ¯”è¾ƒå›°æ‰°æˆ‘ã€‚ ä¸€ä¸‹æ€»ç»“äº†å‡ ç§æƒ…å†µä¸‹thisåˆ†åˆ«æŒ‡å‘çš„å†…å®¹ã€‚ æ€»çš„æ¥è¯´å°±æ˜¯æ ¹æ®æ‰§è¡Œç¯å¢ƒæˆ–å‡½æ•°çš„æ‰§è¡Œæ–¹å¼ä¸åŒï¼Œthisçš„å€¼æœ‰æ‰€ä¸åŒã€‚<br>è¿™é‡Œå‡è®¾æ‰§è¡Œç¯å¢ƒæ˜¯åœ¨æµè§ˆå™¨ç«¯ï¼Œæ‰€æœ‰çš„å…¨å±€å¯¹è±¡éƒ½æ˜¯æŒ‡windowå¯¹è±¡</p>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[understanding express(2)ä¹‹expressJSæ¥æ”¶å’Œå¤„ç†httpè¯·æ±‚è¿‡ç¨‹]]></title>
    <link href="http://yoursite.com/2016/01/28/understanding-express-2/"/>
    <id>http://yoursite.com/2016/01/28/understanding-express-2/</id>
    <published>2016-01-27T16:08:16.000Z</published>
    <updated>2016-01-28T02:28:56.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>Have the courage to follow your heart and intuition. They somehow already know what you truly want to become. Everything else is secondary</p>
</blockquote>
<p>ä»Šå¤©æ¥äº†è§£æ•´ä¸ªæ¥æ”¶å’Œå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ã€‚</p>
<p><a href="http://angelina999990.gitcafe.io/2016/01/25/understanding-expressJS/" target="_blank" rel="external">ä¸Šä¸€ç« </a>è¯´äº†å½“æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•° <code>app.handle(req, res, next);</code> æ¥å¤„ç†è¯·æ±‚çš„ã€‚ä»Šå¤©æ¥è¯´ä¸€ä¸‹å…·ä½“ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ã€‚</p>
<p>æ”¶åˆ°è¯·æ±‚ä¼šæ‰§è¡Œ<code>app.handle(req, res, next)</code>ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<pre><code><span class="comment">//application.js</span>
app.handle = <span class="function"><span class="keyword">function</span><span class="params">(req, res, done)</span> </span>{
  <span class="keyword">var</span> router = <span class="keyword">this</span>._router;

  <span class="comment">// final handler</span>
  done = done || finalhandler(req, res, {
    env: <span class="keyword">this</span>.<span class="keyword">get</span>(<span class="string">'env'</span>),
    onerror: logerror.bind(<span class="keyword">this</span>)
  });

  <span class="comment">// no routes</span>
  <span class="keyword">if</span> (!router) {
    debug(<span class="string">'no routes defined on app'</span>);
    done();
    <span class="keyword">return</span>;
  }

  router.handle(req, res, done);
};
</code></pre><p>è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°reqï¼Œresï¼Œnextã€‚ å…¶ä¸­nextå°±æ˜¯ä¸Šé¢çš„done, é»˜è®¤æ˜¯finalhandlerã€‚å…·ä½“å¯ä»¥çœ‹<a href="https://github.com/pillarjs/finalhandler" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚ç„¶åè°ƒç”¨router.handle()å¼€å§‹é“¾å¼è°ƒç”¨ã€‚</p>
<p>router.handler ä»£ç æ¯”è¾ƒé•¿ï¼Œå…ˆçœ‹ç»“æ„ï¼š</p>
<pre><code><span class="comment">// router/index.js</span>
proto.handle = <span class="function"><span class="keyword">function</span><span class="params">(req, res, done)</span> </span>{
  ...... <span class="comment">//å®šä¹‰ä¸€äº›åŸºæœ¬å˜é‡</span>

  next();

  <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">(err)</span> </span>{
    ......
  }

  <span class="function"><span class="keyword">function</span> <span class="title">trim_prefix</span><span class="params">(layer, layerError, layerPath, path)</span> </span>{
    ...... <span class="comment">//å¯¹è·¯å¾„åšäº›å¤„ç†å†è°ƒç”¨layer.handle_request</span>
  }
};
</code></pre><p>å…¶ä¸­é€šè¿‡é€’å½’è°ƒç”¨next()æ¥éå†stack(å­˜æ”¾ä¸­é—´ä»¶çš„æ ˆï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„)çœ‹æ˜¯å¦æœ‰åŒ¹é…çš„ä¸­é—´ä»¶ã€‚åœ¨proto.handleçš„å¼€å¤´å°±å®šä¹‰äº†idx=0ï¼Œè¡¨ç¤ºå½“å‰ä¸­é—´ä»¶ç´¢å¼•ã€‚åœ¨next()ä¸­é¦–å…ˆåˆ¤æ–­å½“å‰ä¸­é—´ä»¶ç´¢å¼•æ˜¯å¦å¤§äºstack.lengthã€‚ å¦‚æœæ˜¯è¯´æ˜å·²éå†å®Œï¼Œç›´æ¥æ‰§è¡Œdone()ã€‚</p>
<pre><code>// <span class="keyword">function</span> next()
<span class="keyword">if</span> (idx &gt;= stack.length) {
  <span class="built_in">set</span>Immediate(<span class="keyword">done</span>, layerError);
  <span class="built_in">return</span>;
}
</code></pre><p>å¦åˆ™çš„è¯æ‰§è¡Œwhileå¾ªç¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ä»¥å¤„ç†httpè¯·æ±‚çš„ä¸­é—´ä»¶ã€‚ æ¥çœ‹ä¸€ä¸‹whileçš„ä¸»è¦ä»£ç ï¼š</p>
<pre><code>// function next()
<span class="keyword">var</span> layer;
<span class="keyword">var</span> match;
<span class="keyword">var</span> route;

<span class="keyword">while</span> (match !== <span class="literal">true</span> &amp;&amp; idx &lt; stack.length) {
  layer = stack[idx++];
  match = matchLayer(layer, path);  //è°ƒç”¨äº†layer.match æ–¹æ³•
  route = layer.route;

  <span class="keyword">if</span> (typeof match !== 'boolean') {
    layerError = layerError || match;
  }

  <span class="keyword">if</span> (match !== <span class="literal">true</span>) {
    <span class="keyword">continue</span>; // ä¸åŒ¹é…ï¼Œé€€å‡ºæœ¬æ¬¡å¾ªç¯ã€‚
  }

  <span class="keyword">if</span> (!route) {
    <span class="keyword">continue</span>;
  }

  <span class="keyword">if</span> (layerError) {
    match = <span class="literal">false</span>;
    <span class="keyword">continue</span>;
  }

  <span class="keyword">var</span> <span class="keyword">method</span> = req.<span class="keyword">method</span>;
  <span class="keyword">var</span> has_method = route._handles_method(<span class="keyword">method</span>);

  <span class="keyword">if</span> (!has_method &amp;&amp; <span class="keyword">method</span> === '<span class="type">OPTIONS</span>') {
    appendMethods(options, route._options());
  }

  <span class="keyword">if</span> (!has_method &amp;&amp; <span class="keyword">method</span> !== '<span class="type">HEAD</span>') {
    match = <span class="literal">false</span>;
    <span class="keyword">continue</span>;
  }
}
</code></pre><p>é€šè¿‡matchLayerç¡®å®šå½“å‰layeræ˜¯å¦ä¸å½“å‰è·¯å¾„åŒ¹é…ã€‚ä¸åŒ¹é…åˆ™ç›´æ¥ç»“æŸæœ¬æ¬¡å¾ªç¯è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„åˆ¤æ–­ã€‚matchä¸ºtrueä½†æ˜¯layer.routeä¸å­˜åœ¨ï¼Œè¯´æ˜ä¸æ˜¯è·¯ç”±ä¸­é—´ä»¶ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œç”±äºæ­¤æ—¶matchä¸ºtrueä¼šç»“æŸwhileå¾ªç¯ç›´æ¥è¿›å…¥ä¸‹é¢çš„æ­¥éª¤ï¼ˆè¿™ä¸ªç¨åè¯´ï¼‰ã€‚ å¦‚æœrouteå­˜åœ¨ï¼Œå³æ˜¯è·¯ç”±ä¸­é—´ä»¶ï¼Œå†åˆ¤æ–­è¯¥è·¯ç”±å¯å¤„ç†çš„httpæ–¹æ³•æ˜¯å¦ä¸è¯·æ±‚çš„httpæ–¹æ³•ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´åˆ™æ ¹æ®å…¶methodæ˜¯å¦ä¸ºoptionsæˆ–headåšç›¸åº”å¤„ç†ï¼Œä¸€è‡´åˆ™ä¸å†å¯¹matchåšä¿®æ”¹ï¼Œè¿™æ ·æ‰§è¡Œä¸‹æ¬¡whileå¾ªç¯çš„æ—¶å€™ç”±äºmatchä¸ºtrueä¼šç»“æŸå¾ªç¯è¿›å…¥ä¸‹é¢çš„æ­¥éª¤ã€‚</p>
<pre><code>// <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">()</span></span> ç»“æŸ<span class="keyword">while</span>å¾ªç¯åçš„éƒ¨åˆ†

<span class="keyword">if</span> (match !== <span class="keyword">true</span>) {
   //ç»“æŸå¾ªç¯åmatchä»ç„¶ä¸º<span class="keyword">false</span>, è¯´æ˜æ˜¯éå†å®Œstack, æ²¡æœ‰åŒ¹é…çš„ä¸­é—´ä»¶
  <span class="keyword">return</span> done(layerError);
}

<span class="keyword">if</span> (route) {
  req.route = route;
}

req.params = self.mergeParams
  ? mergeParams(layer.params, parentParams)
  : layer.params;
var layerPath = layer.path;

self.process_params(layer, paramcalled, req, res, <span class="function"><span class="keyword">function</span> <span class="params">(err)</span></span> {
  <span class="keyword">if</span> (err) {
    <span class="keyword">return</span> <span class="built_in">next</span>(layerError || err);
  }

  <span class="keyword">if</span> (route) {
    //<span class="built_in">next</span>ä½œä¸ºå›è°ƒå‡½æ•°ä¼ å…¥handle_request,å½¢æˆä¸€ä¸ªé—­åŒ…ï¼Œå†åœ¨handle_requestä¸­è°ƒç”¨<span class="built_in">next</span>()çš„æ—¶å€™idxçš„å€¼ä»ç„¶æ˜¯ä¸Šä¸€æ¬¡é€€å‡º<span class="keyword">while</span>å¾ªç¯çš„å€¼
    <span class="keyword">return</span> layer.handle_request(req, res, <span class="built_in">next</span>);
  }

  //å¯¹è·¯å¾„åšäº›å¤„ç†å†è°ƒç”¨layer.handle_request
  trim_prefix(layer, layerError, layerPath, path);
});
</code></pre><p>è¿™éƒ¨åˆ†é¦–å…ˆè¿›è¡Œä¸€äº›å‚æ•°é¢„å¤„ç†ï¼Œå¦‚æœä¸ºè·¯ç”±ä¸­é—´ä»¶å°±ç›´æ¥è°ƒç”¨layer.handle_requestï¼Œå¦åˆ™å…ˆå¯¹è·¯å¾„åšäº›å¤„ç†å†è°ƒç”¨layer.handle_requestã€‚ä¸‹é¢æ˜¯layer.handle_requestçš„ä»£ç ï¼š</p>
<pre><code><span class="comment">// router/layer.js</span>
Layer.prototype.handle_request = <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">(req, res, next)</span> </span>{
  <span class="keyword">var</span> fn = <span class="keyword">this</span>.handle;

  <span class="keyword">if</span> (fn.length &gt; <span class="number">3</span>) {
    <span class="comment">// not a standard request handler</span>
    <span class="keyword">return</span> next();
  }

  <span class="keyword">try</span> {
    fn(req, res, next);
  } <span class="keyword">catch</span> (err) {
    next(err);
  }
};
</code></pre><p>layer.handle_requestä¼šåœ¨Router.handleå’Œroute.dispatchä¸­è°ƒç”¨ã€‚æ³¨æ„è‹¥æ˜¯ä»Router.handleè°ƒç”¨çš„ï¼Œnextæ˜¯Router.handleé‡Œå®šä¹‰çš„nextï¼Œè‹¥æ˜¯ä»route.dispatchè°ƒç”¨çš„ï¼Œnextæ˜¯dispatché‡Œå®šä¹‰çš„nextã€‚ ä¸åŒçš„nextéå†çš„å¯¹è±¡æœ‰æ‰€ä¸åŒã€‚ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code><span class="comment">//app.js</span>
    <span class="keyword">var</span> user = <span class="keyword">require</span>(<span class="string">'user'</span>);
    <span class="keyword">var</span> app = express();

    app.<span class="keyword">use</span>(<span class="string">'/index'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
        <span class="comment">//do something</span>
    })
    app.<span class="keyword">use</span>(<span class="string">'/user'</span>, user);


<span class="comment">//user.js</span>
    <span class="keyword">var</span> userRouter = <span class="keyword">require</span>(<span class="string">'express'</span>).Router();
    <span class="keyword">var</span> checkAuth = <span class="function"><span class="keyword">function</span><span class="params">(req, res, next)</span></span>{
        <span class="comment">//... check auth</span>
        next()
    };
    <span class="keyword">var</span> getList = <span class="function"><span class="keyword">function</span><span class="params">(req, res, next)</span> </span>{
        <span class="comment">//... get user list</span>
    }

    userRouter.get(<span class="string">'/list'</span>, checkAuth, getList);
    module.exports = userRouter;
</code></pre><p>app.jsä¸­çš„ä¸¤ä¸ªapp.useå…¶å®æ˜¯è°ƒç”¨router.useåˆ›å»ºäº†ä¸¤ä¸ªlayerå¯¹è±¡å¹¶å°†å…¶æ·»åŠ åˆ°app._router.stackä¸­ï¼Œä»¥ä¸‹ç®€ç§°Routerã€‚Router.stackåº”è¯¥æ˜¯ç±»ä¼¼è¿™æ ·çš„<code>[ layer1, layer2 ]</code>ã€‚ å…¶ä¸­layer2å®é™…ä¸Šæ˜¯express.Router()çš„å¯¼å‡ºå¯¹è±¡, åœ¨app.useæ–¹æ³•ä¸­ä¼šè§†ä¸ºä¸€ä¸ªå­appå°è£…ä¸€å±‚ã€‚åƒè¿™æ ·ï¼š</p>
<pre><code><span class="comment">//application.js app.use()</span>
<span class="function"><span class="keyword">function</span> <span class="title">mounted_app</span><span class="params">(req, res, next)</span> </span>{
  <span class="keyword">var</span> orig = req.app;
  fn.handle(req, res, <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> </span>{
    req.__proto__ = orig.request;
    res.__proto__ = orig.response;
    next(err);
});
</code></pre><p>è¿™é‡Œçš„fnå®é™…ä¸Šå°±æ˜¯<code>app.use(&#39;/user&#39;,user)</code>ä¸­çš„userï¼ˆå³user.jsä¸­å¯¼å‡ºçš„Routerï¼‰ã€‚å®Œæ•´ä»£ç å¯æŸ¥çœ‹application.js çš„app.useã€‚</p>
<p>ä¸Šé¢user.jsä¸­è°ƒç”¨userRouter.getæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„routeå’Œlayerï¼ˆè¿™é‡Œæš‚æ—¶å«newLayer, è¿™ä¸ªlayerä¼šè¢«pushåˆ°userRouter.stackä¸­ï¼‰ï¼Œ å†è°ƒç”¨route.getæ–¹æ³•æŠŠcheckAuthå’ŒgetListæ·»åŠ åˆ°route.stackä¸­ï¼Œæ‰€ä»¥è¯¥routeçš„stackåº”è¯¥ç±»ä¼¼è¿™æ · <code>[ layer3, layer4 ]</code>ï¼ŒuserRouter.stackæ˜¯è¿™æ ·çš„<code>[ newLayer ]</code>ã€‚ è¿™é‡Œé™„ä¸ŠRouter.routeå’Œ Router.VERBçš„ä»£ç ã€‚</p>
<pre><code>// router/index.js
proto.route = function(path){
  <span class="keyword">var</span> route = new <span class="type">Route</span>(path);

  <span class="keyword">var</span> layer = new <span class="type">Layer</span>(path, {
    sensitive: this.caseSensitive,
    strict: this.strict,
    <span class="keyword">end</span>: <span class="literal">true</span>
  }, route.dispatch.<span class="keyword">bind</span>(route)); //layer.handle=route.dispatch

  layer.route = route;

  this.stack.push(layer);
  <span class="keyword">return</span> route;
};

// åˆ›å»º <span class="type">Router</span><span class="comment">#VERB functions</span>
methods.concat('all').forEach(function(<span class="keyword">method</span>){
  proto[<span class="keyword">method</span>] = function(path){

    // è°ƒç”¨proto.route new ä¸€ä¸ªrouteå¯¹è±¡ã€‚
    <span class="keyword">var</span> route = this.route(path)

    //åœ¨route.<span class="type">VERB</span>æˆ–route.allä¸­ä¼šæŠŠä¼ å…¥çš„fnæ·»åŠ åˆ°è¯¥routeçš„stackä¸­
    route[<span class="keyword">method</span>].apply(route, slice.call(arguments, <span class="number">1</span>));
    <span class="keyword">return</span> this;
  };
});
</code></pre><p>æ‰€ä»¥å½“æ”¶åˆ°ä¸€ä¸ªhttpè¯·æ±‚(eg. <a href="http://host.com/user/list)ï¼Œ" target="_blank" rel="external">http://host.com/user/list)ï¼Œ</a> é¦–å…ˆæ‰§è¡Œapp.handle(), åœ¨ <code>[layer1, layer2]</code>ä¸­æŸ¥æ‰¾åŒ¹é…ï¼Œå½“æŸ¥æ‰¾çš„layer2çš„æ—¶å€™ï¼Œè·¯å¾„åŒ¹é…ä¸”layer2ä¸æ˜¯ä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œè¿›å…¥åˆ°layer.handle_requestè°ƒç”¨layer.handle(è¿™é‡Œçš„layer.handleå°±æ˜¯mounted_appæ–¹æ³•),é‡Œé¢åˆè°ƒç”¨fn.handleå°±æ˜¯æ‰§è¡ŒuserRouter.handleæ–¹æ³•ï¼Œåˆç»§ç»­åœ¨userRouter.stackï¼ˆ<code>[ newLayer ]</code>ï¼‰ä¸­æŸ¥æ‰¾åŒ¹é…, newLayerè·¯å¾„ä¸è¯·æ±‚è·¯å¾„åŒ¹é…ä¸”æ˜¯è·¯ç”±ä¸­é—´ä»¶ï¼Œè¿›å…¥layer.handle_requestæ‰§è¡Œlayer.handleï¼Œæ³¨æ„è¿™é‡Œçš„layer.handleæ˜¯route.dispatchï¼Œå› ä¸ºåœ¨Router.VERBä¸­åˆ›å»ºlayeræ—¶æ˜¯<code>new Layer(path, option, route.dispatch.bind(route))</code>ã€‚æ‰€ä»¥å°±ä¼šåœ¨route.stack(<code>[ layer3, layer4 ]</code>)ä¸­æŸ¥æ‰¾åŒ¹é…ã€‚é™„ä¸Šroute.dispatchä»£ç ï¼š</p>
<pre><code><span class="type">Route</span>.prototype.dispatch = function(req, res, done){
  <span class="keyword">var</span> idx = <span class="number">0</span>;
  <span class="keyword">var</span> stack = this.stack;
  <span class="keyword">if</span> (stack.length === <span class="number">0</span>) {
    <span class="keyword">return</span> done();
  }

  <span class="keyword">var</span> <span class="keyword">method</span> = req.<span class="keyword">method</span>.toLowerCase();
  <span class="keyword">if</span> (<span class="keyword">method</span> === 'head' &amp;&amp; !this.methods['head']) {
    <span class="keyword">method</span> = 'get';
  }

  req.route = this;

  next();

  function next(err) {
    <span class="keyword">if</span> (err &amp;&amp; err === 'route') {
      <span class="keyword">return</span> done();
    }

    <span class="keyword">var</span> layer = stack[idx++];
    <span class="keyword">if</span> (!layer) {
      <span class="keyword">return</span> done(err);
    }

    <span class="keyword">if</span> (layer.<span class="keyword">method</span> &amp;&amp; layer.<span class="keyword">method</span> !== <span class="keyword">method</span>) {
      <span class="keyword">return</span> next(err);
    }

    <span class="keyword">if</span> (err) {
      layer.handle_error(err, req, res, next);
    } <span class="keyword">else</span> {
      layer.handle_request(req, res, next);
    }
  }
};
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„idxæ˜¯0ï¼Œä¸Router.handle()ä¸­çš„idxä¸åŒï¼Œroute.dispatchæ˜¯åœ¨å½“å‰route.stackä¸­éå†åŒ¹é…ã€‚åœ¨ä¸Šé¢çš„ğŸŒ°ä¸­route.stackå°±æ˜¯<code>[ layer3, layer4 ]</code>ã€‚å¤„ç†é€»è¾‘ä¸Router.handleç±»ä¼¼ï¼Œidxæ˜¯å½“å‰ä¸‹è¡¨ï¼Œstackæ˜¯å½“å‰è·¯ç”±å¤„ç†å‡½æ•°åˆ—è¡¨ï¼Œé€’å½’è°ƒç”¨nextã€‚ è¿™é‡Œnextæ–¹æ³•åˆ¤æ–­å½“å‰layeræ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨æˆ–æ–¹æ³•ä¸åŒ¹é…è°ƒç”¨done, å¦åˆ™æ ¹æ®errå€¼æ‰§è¡Œhandle_requestæˆ–handle_errorã€‚ä¾‹å­ä¸­çš„layer3è·¯å¾„å’Œmethodéƒ½åŒ¹é…ï¼Œæ‰§è¡Œlayer3.handle_requestè°ƒç”¨this.handleå³checkauthæ–¹æ³•ï¼Œå¦‚æœé€šè¿‡éªŒè¯å°±ä¼šæ‰§è¡Œnext(),æ³¨æ„è¿™æ—¶çš„nextæ˜¯dispatchä¸­å®šä¹‰çš„nextæ–¹æ³•ã€‚æ­¤æ—¶idxæŒ‡å‘layer4, ä¾ç„¶åŒ¹é…ï¼Œç»§ç»­æ‰§è¡ŒgetListæ–¹æ³•ã€‚ getListæ‰§è¡Œåè‹¥ä¸å†è°ƒç”¨next(), åˆ™å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ç»“æŸï¼Œ å¦åˆ™ç»§ç»­æ‰§è¡Œnext, æ­¤æ—¶route.stackéå†å®Œå†æ‰¾ä¸åˆ°layerä¼šæ‰§è¡Œdone(err) è¿”å›åˆ°<code>[newLayer]</code>å±‚é¢ï¼ŒuserRouter.stackä¹Ÿéå†å®Œï¼ˆuserRouter.handleä¸­çš„idxæ­¤æ—¶ä¸º1ï¼Œå¤§äº<code>[newLayer].length</code>ï¼‰äºæ˜¯åˆè°ƒç”¨done, å›åˆ°ä¸Šå±‚çš„Router.stackä¸­(<code>[layer1, layer2]</code>)ä¾æ¬¡ç±»æ¨ã€‚å½“çƒ­ç”±äºgetListå¤„ç†å®Œè¯·æ±‚åç›´æ¥reponseæ‰€ä»¥ä¸ä¼šå†è°ƒç”¨next()ã€‚ è¿™é‡Œåªæ˜¯åˆ†æä¸‹å¦‚æœç»§ç»­è°ƒç”¨nextçš„è¡Œä¸ºã€‚</p>
<p>è¡¨è¿°å¾—å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œçœ‹å›¾ï¼š</p>
<p><img src="http://d.pcs.baidu.com/thumbnail/c9ddf27e2239ce53983f5628faab78de?fid=571110063-250528-341365159016922&amp;time=1453910400&amp;sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-89IEUyBrNLkIrRrkm0IX4DReUj4%3D&amp;rt=sh&amp;expires=2h&amp;r=914482467&amp;sharesign=unknown&amp;size=c710_u500&amp;quality=100" alt="httpè¯·æ±‚å¤„ç†è¿‡ç¨‹"></p>
<h3 id="Reference">Reference</h3><ul>
<li><a href="https://github.com/syaning/understanding-express" target="_blank" rel="external">expressæºç è§£æ</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>Have the courage to follow your heart and intuition. They somehow already know what you truly want to become. Everything else is secondary</p>
</blockquote>
<p>ä»Šå¤©æ¥äº†è§£æ•´ä¸ªæ¥æ”¶å’Œå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ã€‚</p>
<p><a href="http://angelina999990.gitcafe.io/2016/01/25/understanding-expressJS/">ä¸Šä¸€ç« </a>è¯´äº†å½“æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•° <code>app.handle(req, res, next);</code> æ¥å¤„ç†è¯·æ±‚çš„ã€‚ä»Šå¤©æ¥è¯´ä¸€ä¸‹å…·ä½“ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ã€‚</p>
<p>æ”¶åˆ°è¯·æ±‚ä¼šæ‰§è¡Œ<code>app.handle(req, res, next)</code>ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>]]>
    
    </summary>
    
      <category term="express" scheme="http://yoursite.com/tags/express/"/>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="node" scheme="http://yoursite.com/tags/node/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[understanding expressJS (1)]]></title>
    <link href="http://yoursite.com/2016/01/25/understanding-expressJS/"/>
    <id>http://yoursite.com/2016/01/25/understanding-expressJS/</id>
    <published>2016-01-25T12:39:34.000Z</published>
    <updated>2016-01-27T16:10:18.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>Working like donâ€™t need money, dancing like no oneâ€™s watching, love like never get hurt</p>
</blockquote>
<p>è¿™é‡Œä¸»è¦äº†è§£ä¸€ä¸‹å¯åŠ¨ä¸€ä¸ªexpress åº”ç”¨çš„è¿‡ç¨‹</p>
<pre><code><span class="comment">//express.js</span>
function createApplication() {
  <span class="keyword">var</span> <span class="keyword">app</span> = function(req, res, next) {
    <span class="keyword">app</span>.handle(req, res, next);
  };

  mixin(<span class="keyword">app</span>, EventEmitter.prototype, false);
  mixin(<span class="keyword">app</span>, proto, false);

  <span class="keyword">app</span>.request = { __proto__: req, <span class="keyword">app</span>: <span class="keyword">app</span> };
  <span class="keyword">app</span>.response = { __proto__: res, <span class="keyword">app</span>: <span class="keyword">app</span> };
  <span class="keyword">app</span>.init();
  <span class="keyword">return</span> <span class="keyword">app</span>;
}
</code></pre><a id="more"></a>
<p>express.js å®é™…ä¸Šå®šä¹‰å¯¼å‡ºäº†ä¸€ä¸ªcreateApplicationçš„å‡½æ•°ã€‚express()å®é™…ä¸Šæ˜¯å¾—åˆ°äº†ä¸€ä¸ªappçš„å®ä¾‹ã€‚</p>
<pre><code><span class="keyword">mixin</span>(app, proto, <span class="literal">false</span>);
</code></pre><p>è¿™æ®µä»£ç çš„ä½œç”¨å°±æ˜¯æŠŠapplication.jsä¸‹å®šä¹‰çš„å±æ€§æ‰©å±•åˆ°appä¸Šã€‚</p>
<pre><code><span class="comment">// bin/www</span>
<span class="variable"><span class="keyword">var</span> server</span> = http.createServer(app);
</code></pre><p>http.createServer æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºrequestäº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚å®é™…ä¸‹é¢è¿™ç§å†™æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
<pre><code>var <span class="keyword">server</span> = http.createServer();
<span class="keyword">server</span>.on(<span class="string">'request'</span>, app);
</code></pre><p>è¿™é‡Œä¼ åˆ°createServerçš„appå°±æ˜¯ä¸Šé¢å¾—åˆ°çš„appå®ä¾‹ï¼ˆå®é™…å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ã€‚åœ¨æ¥æ”¶åˆ°httpè¯·æ±‚æ—¶ä¼šæ‰§è¡Œapp.handle æ–¹æ³•ã€‚app.handle æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code><span class="comment">//application.js</span>
app.handle = <span class="function"><span class="keyword">function</span><span class="params">(req, res, done)</span> </span>{
  <span class="keyword">var</span> router = <span class="keyword">this</span>._router;

  <span class="comment">// final handler</span>
  done = done || finalhandler(req, res, {
    env: <span class="keyword">this</span>.<span class="keyword">get</span>(<span class="string">'env'</span>),
    onerror: logerror.bind(<span class="keyword">this</span>)
  });

  <span class="comment">// no routes</span>
  <span class="keyword">if</span> (!router) {
    debug(<span class="string">'no routes defined on app'</span>);
    done();
    <span class="keyword">return</span>;
  }

  router.handle(req, res, done);
};
</code></pre><p>this._router(å³app._router)å®é™…ä¸Šæ˜¯åœ¨app.lazyrouteræ–¹æ³•ä¸­newçš„ä¸€ä¸ªRouterå¯¹è±¡, ä¸€èˆ¬åœ¨å®šä¹‰ä¸­é—´ä»¶çš„æ—¶å€™ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•æ¥ç»™appæ·»åŠ ä¸€ä¸ª_routerå±æ€§ã€‚ æ‰€ä»¥ä¸Šé¢çš„app.handle å…¶å®æ˜¯router.handleçš„ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨çš„router.handle()ã€‚è‡³äºå…·ä½“å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹å¦å†™ä¸€éå…·ä½“ä»‹ç»ã€‚</p>
<p>å›åˆ°www/binæ–‡ä»¶</p>
<pre><code>var <span class="keyword">port</span> = normalizePort(<span class="keyword">process</span>.env.<span class="keyword">PORT</span> || '<span class="number">3001</span>');
app.set(<span class="attribute">'port</span>', <span class="keyword">port</span>);

var server = http.createServer(app);

server.listen(<span class="keyword">port</span>);
server.<span class="keyword">on</span>(<span class="attribute">'error</span>', onError);
server.<span class="keyword">on</span>(<span class="attribute">'listening</span>', onListening);
</code></pre><p>è¿™é‡Œé¦–å…ˆå¢åŠ portå±æ€§åˆ°app.jsã€‚ ç„¶ååˆ›å»ºä¸€ä¸ªhttp server å¹¶ç›‘å¬å®ƒçš„request, err, listeningæ—¶é—´ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>Working like donâ€™t need money, dancing like no oneâ€™s watching, love like never get hurt</p>
</blockquote>
<p>è¿™é‡Œä¸»è¦äº†è§£ä¸€ä¸‹å¯åŠ¨ä¸€ä¸ªexpress åº”ç”¨çš„è¿‡ç¨‹</p>
<pre><code><span class="comment">//express.js</span>
function createApplication() {
  <span class="keyword">var</span> <span class="keyword">app</span> = function(req, res, next) {
    <span class="keyword">app</span>.handle(req, res, next);
  };

  mixin(<span class="keyword">app</span>, EventEmitter.prototype, false);
  mixin(<span class="keyword">app</span>, proto, false);

  <span class="keyword">app</span>.request = { __proto__: req, <span class="keyword">app</span>: <span class="keyword">app</span> };
  <span class="keyword">app</span>.response = { __proto__: res, <span class="keyword">app</span>: <span class="keyword">app</span> };
  <span class="keyword">app</span>.init();
  <span class="keyword">return</span> <span class="keyword">app</span>;
}
</code></pre>]]>
    
    </summary>
    
      <category term="express" scheme="http://yoursite.com/tags/express/"/>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="node" scheme="http://yoursite.com/tags/node/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Understanding node process (2)]]></title>
    <link href="http://yoursite.com/2015/09/26/Understanding-node-process-2/"/>
    <id>http://yoursite.com/2015/09/26/Understanding-node-process-2/</id>
    <published>2015-09-26T09:56:26.000Z</published>
    <updated>2015-09-26T10:05:57.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>If you have been broken, mend yourself. Knowing that you will become more beautiful. And always think before you act. an apology cannot repair something youâ€™ve done without thought.</p>
</blockquote>
<p>Last week we talked about multi process and process communication. Today weâ€™re going to take a look at its stability.</p>
<p>Having multi processes work together can improve the usage of our cups at some extend. But how it stability is? What if the process exits unexpected?</p>
<a id="more"></a>
<p>nodeâ€™s child_process does have some events available here so we can take advantage of those events listener to manage our process.</p>
<h2 id="process_restart">process restart</h2><p>Letâ€™s first listen to its exit event and create a new one when process exits.</p>
<pre><code><span class="comment">// master.js</span>
<span class="keyword">var</span> fork = <span class="built_in">require</span>(<span class="string">"child_process"</span>).fork,
  cpus = <span class="built_in">require</span>(<span class="string">"os"</span>).cpus(),
  server = <span class="built_in">require</span>(<span class="string">"net"</span>).createServer()
  workers = {};

server.listen(<span class="number">1337</span>);

<span class="keyword">var</span> createWorker = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">var</span> worker = fork(<span class="string">"./test/worker.js"</span>);
  worker.send(<span class="string">"server"</span>, server);
  workers[worker.pid] = worker;
  <span class="built_in">console</span>.log(<span class="string">"create worker. pid: "</span> + worker.pid);

  worker.on(<span class="string">"exit"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
    <span class="built_in">console</span>.log(<span class="string">"worker "</span> + worker.pid + <span class="string">" exited."</span>);
    <span class="keyword">delete</span> workers[worker.pid];
    createWorker();
  });
};

<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;cpus.length; i++) {
  createWorker();
}

process.on(<span class="string">"exit"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">for</span> (pid <span class="keyword">in</span> workers) {
    workers[pid].kill();
  }
});
</code></pre><p>The code above defined a createWorker function. Every worker that is created by this function will listen to its own exit event and create a new worker process once it exits. If the master process self exits, all workers will be killed.<br>The worker.js would look like this:</p>
<pre><code><span class="comment">//worker.js</span>
<span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span> </span>{
  res.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
  res.end(<span class="string">'handled by child, pid is '</span> + process.pid + <span class="string">'\n'</span>);
});

process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(m, tcp)</span> </span>{
  <span class="keyword">if</span>(m === <span class="string">'server'</span>) {
    tcp.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span> </span>{
      server.emit(<span class="string">'connection'</span>, socket);
    });
  }
});
</code></pre><p>Run <code>node master.js</code> to create those process.</p>
<pre><code>&gt; node master.js
create worker. <span class="string">pid:</span> <span class="number">1089</span>
create worker. <span class="string">pid:</span> <span class="number">1090</span>
create worker. <span class="string">pid:</span> <span class="number">1091</span>
create worker. <span class="string">pid:</span> <span class="number">1092</span>
</code></pre><p>Now letâ€™s kill a process to see whatâ€™s going on.</p>
<pre><code>&gt; <span class="built_in">kill</span> <span class="number">1089</span>
worker <span class="number">1089</span> exited.
<span class="built_in">create</span> worker. pid: <span class="number">1280</span>
</code></pre><p>Aha, one exits, one created.</p>
<p>Here we just killed a process manually. In most cases, there may be some undetected bugs caused unexpected exit. So itâ€™d better to use uncaughtException event to listen uncaught error and do some synchronous cleanup before shutting down the process. Here, for test use, we just exit process to see how it works.</p>
<pre><code><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span> </span>{
  res.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
  res.end(<span class="string">'handled by child, pid is '</span> + process.pid + <span class="string">'\n'</span>);
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"throw exception"</span>);
});

<span class="keyword">var</span> worker;
process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(m, tcp)</span> </span>{
  <span class="keyword">if</span>(m === <span class="string">'server'</span>) {
    worker = tcp;
    tcp.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span> </span>{
      server.emit(<span class="string">'connection'</span>, socket);
    });
  }
});

process.on(<span class="string">'uncaughtException'</span>, <span class="function"><span class="keyword">function</span><span class="params">(err)</span> </span>{
  process.send({signal: <span class="string">'suicide'</span>}); <span class="comment">//send a suicide signal to master process</span>
  worker.close(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
    process.exit();
  });
});
</code></pre><p>To simulate uncaught exception, we throw an error every time there is incomint request so that every time connect to the sever, a process will exit.</p>
<p>Note that we want the master process to recreate a process once error happened instead of waiting for worker process exits to ensure incoming request would be handled as much as possible. This could be done by creating worker in message event.</p>
<pre><code><span class="keyword">var</span> createWorker = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">var</span> worker = fork(<span class="string">"./test/worker.js"</span>);
  worker.send(<span class="string">"server"</span>, server);
  workers[worker.pid] = worker;
  <span class="built_in">console</span>.log(<span class="string">"create worker. pid: "</span> + worker.pid);

  worker.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span><span class="params">(message)</span> </span>{
  <span class="keyword">if</span>(message.signal === <span class="string">'suicide'</span>) {
      createWorker();
  }
  });

  worker.on(<span class="string">"exit"</span>, <span class="function"><span class="keyword">function</span><span class="params">(code, sign)</span> </span>{
  <span class="built_in">console</span>.log(<span class="string">"worker "</span> + worker.pid + <span class="string">" exited."</span>);
  <span class="keyword">delete</span> workers[worker.pid];
  });
};
</code></pre><h2 id="limit_restarts">limit restarts</h2><p>One more thing to do. If the error happens when creating the process, it is not in the case of uncaughtException. That would cause unlimit process restart. To avoid this unlimit restart, itâ€™d better to limit the number of restarts during a period of time.</p>
<pre><code><span class="comment">//master.js</span>
<span class="keyword">var</span> fork = <span class="built_in">require</span>(<span class="string">"child_process"</span>).fork,
  cpus = <span class="built_in">require</span>(<span class="string">"os"</span>).cpus(),
  server = <span class="built_in">require</span>(<span class="string">"net"</span>).createServer()
  workers = {},
  limit = <span class="number">10</span>,<span class="comment">//restart limit</span>
  restart = [];

server.listen(<span class="number">1337</span>);

<span class="keyword">var</span> isTooFrequently = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">var</span> time = <span class="built_in">Date</span>.now();
  <span class="keyword">var</span> length = restart.push(time);
  <span class="keyword">if</span>(length &gt; limit) {
    restart = restart.slice(limit * -<span class="number">1</span>);
  }
  <span class="keyword">return</span> restart.length &gt;= limit &amp;&amp; restart[restart.length -<span class="number">1</span>] -restart[<span class="number">0</span>] &lt;during;
}

<span class="keyword">var</span> createWorker = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">if</span>(isTooFrequently()) {
    process.emit(<span class="string">'giveup'</span>, length, during);
    <span class="keyword">return</span>;
  }
  <span class="keyword">var</span> worker = fork(<span class="string">"worker.js"</span>);
  worker.send(<span class="string">"server"</span>, server);
  workers[worker.pid] = worker;
  <span class="built_in">console</span>.log(<span class="string">"create worker. pid: "</span> + worker.pid);

  worker.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span><span class="params">(message)</span> </span>{
    <span class="keyword">if</span>(message.signal === <span class="string">'suicide'</span>) {
      createWorker();
    }
  });

  worker.on(<span class="string">"exit"</span>, <span class="function"><span class="keyword">function</span><span class="params">(code, sign)</span> </span>{
    <span class="built_in">console</span>.log(<span class="string">"worker "</span> + worker.pid + <span class="string">" exited."</span>);
    <span class="keyword">delete</span> workers[worker.pid];
  });
};

<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cpus.length; i++) {
  createWorker();
}

process.on(<span class="string">"exit"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">for</span> (pid <span class="keyword">in</span> workers) {
    workers[pid].kill();
  }
});
</code></pre><p>This isTooFrequently function does the judgement. It emits giveup event if restarts more than 10 times in a minute.</p>
<h2 id="reference">reference</h2><ul>
<li><a href="https://book.douban.com/subject/25768396/" target="_blank" rel="external">æ·±å…¥æµ…å‡ºnodejs</a></li>
<li><a href="https://nodejs.org/api/process.html#process_signal_events" target="_blank" rel="external">Node.js v4.1.1 Documentation</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>If you have been broken, mend yourself. Knowing that you will become more beautiful. And always think before you act. an apology cannot repair something youâ€™ve done without thought.</p>
</blockquote>
<p>Last week we talked about multi process and process communication. Today weâ€™re going to take a look at its stability.</p>
<p>Having multi processes work together can improve the usage of our cups at some extend. But how it stability is? What if the process exits unexpected?</p>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="node" scheme="http://yoursite.com/tags/node/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[understanding node process(1)]]></title>
    <link href="http://yoursite.com/2015/09/19/understanding-node-process-1/"/>
    <id>http://yoursite.com/2015/09/19/understanding-node-process-1/</id>
    <published>2015-09-19T12:52:53.000Z</published>
    <updated>2015-09-19T13:13:21.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>And Lost be the day to us in Which a measure hath not been danced.</p>
<p>And false be every truth which hath not had laughter along with it.</p>
<p>â€” Niezsche</p>
</blockquote>
<p>As we know, javascript is running on a single process, which brings a question, how can we get the multi-core CPU fully work?</p>
<a id="more"></a>
<h2 id="Multi-process_structure">Multi-process structure</h2><p>Fortunately, node offers us child_process moudle so that we can easily create multi-porcess and work them together.</p>
<p>First of all, we create a js file named parent.js which will create a child process and listen to it.</p>
<pre><code><span class="comment">//parent.js</span>
<span class="keyword">var</span> cp = <span class="built_in">require</span>(<span class="string">'child_process'</span>),
    n = cp.fork(<span class="string">'test/child.js'</span>);

n.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(m)</span> </span>{
  <span class="built_in">console</span>.log(<span class="string">'parent got message: '</span>, m);
});

n.send({hello: <span class="string">'world'</span>});
</code></pre><p>Note that <code>fork</code> creates a new process whice has all the mehods in a normal ChildProcess with a build-in communication channel(Inter-Process communication channel ). So we can write to a child using <code>send</code> method.</p>
<p>what the child process does is, as same as the parent processâ€™s, listening to the parent process. When there is message come, they print the message out.</p>
<pre><code>process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(m)</span> </span>{
  <span class="built_in">console</span>.log(<span class="string">'child got meaage: '</span>, m);
});
process.send({foo: <span class="string">'bar'</span>});
</code></pre><p>Running command  <code>node parent.js</code> we can get the following:</p>
<pre><code>child got <span class="string">meaage:</span>  { <span class="string">hello:</span> <span class="string">'world'</span> }
parent got <span class="string">message:</span>  { <span class="string">foo:</span> <span class="string">'bar'</span> }
</code></pre><p>Here we go, now we have two process runing and communicating.</p>
<h2 id="the_handler_delivery">the handler delivery</h2><p>Only text message sent is probably not enough. However, we can also send TCP server or socket object as handler to another process.</p>
<pre><code><span class="comment">//parent.js</span>
<span class="keyword">var</span> cp = <span class="built_in">require</span>(<span class="string">'child_process'</span>),
  child = cp.fork(<span class="string">'test/child.js'</span>);

<span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'net'</span>).createServer();
server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span> </span>{
  socket.end(<span class="string">'handled by parent\n'</span>);
});

server.listen(<span class="number">1337</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  child.send(<span class="string">'server'</span>, server);
});
</code></pre><p>the child.js would look like this:</p>
<pre><code>process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(m, server)</span></span> {
  <span class="keyword">if</span>(m === <span class="string">'server'</span>) {
    server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span></span> {
      socket.<span class="keyword">end</span>(<span class="string">'handled by child\n'</span>);
    });
  }
});
</code></pre><p>Now the server is shared between the parent and child. That means connections can be handled by either of them. Running <code>node parent.js</code> and we test it by <code>curl &quot;http://localhost:1337/&quot;</code> the result can be both.</p>
<p>What if we seperate the tasks of parent process and child process? Once the handle is sent to child process from parent process, we close the server so it no longer listens to the port.</p>
<pre><code><span class="comment">//parent.js</span>
<span class="keyword">var</span> cp = <span class="built_in">require</span>(<span class="string">'child_process'</span>),
    child1 = cp.fork(<span class="string">'test/child.js'</span>),
    child2 = cp.fork(<span class="string">'test/child.js'</span>);

<span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'net'</span>).createServer();

server.listen(<span class="number">1337</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  child1.send(<span class="string">'server'</span>, server);
  child2.send(<span class="string">'server'</span>, server);
  server.close();
});

server.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
  <span class="built_in">console</span>.log(<span class="string">'server closed'</span>);
})
</code></pre><p>change child.js a litte:</p>
<pre><code><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span> </span>{
  res.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
  res.end(<span class="string">'handled by child, pid is '</span> + process.pid + <span class="string">'\n'</span>);
});

process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(m, tcp)</span> </span>{
  <span class="keyword">if</span>(m === <span class="string">'server'</span>) {
    tcp.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span> </span>{
      server.emit(<span class="string">'connection'</span>, socket);
    });
  }
});
</code></pre><p>Now we have two child processes to listen to the port. Once TCP connection is emited, we emit http connection and send client socket object to http server to do something.</p>
<p>Notice that tcp server is shard by more than one child process, Itâ€™s possible that the request is handled by differnt child process. But itâ€™s fine. The process  service is preemptive. Depends how busy the process is, the less busy one will handle the request.</p>
<p>Even if node is running on a single process, with multi-process running, we can still better using multi-core CPU and likely to handle high loads situation.</p>
<h3 id="Reference">Reference</h3><ul>
<li><a href="https://nodejs.org/api/child_process.html" target="_blank" rel="external">Node.js v4.1.0 Documentation</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>And Lost be the day to us in Which a measure hath not been danced.</p>
<p>And false be every truth which hath not had laughter along with it.</p>
<p>â€” Niezsche</p>
</blockquote>
<p>As we know, javascript is running on a single process, which brings a question, how can we get the multi-core CPU fully work?</p>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="node" scheme="http://yoursite.com/tags/node/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æµ…è°ˆjavascriptæ‰§è¡Œä½œç”¨åŸŸ]]></title>
    <link href="http://yoursite.com/2015/08/24/%E6%B5%85%E8%B0%88javascript%E6%89%A7%E8%A1%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    <id>http://yoursite.com/2015/08/24/æµ…è°ˆjavascriptæ‰§è¡Œä½œç”¨åŸŸ/</id>
    <published>2015-08-24T13:24:25.000Z</published>
    <updated>2015-08-24T15:49:35.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>An old Cherokee told his grandson â€œmy son, there is a battle between 2 wolves inside us all. One is Evil. It is anger, jealousy, greed, resentment, inferiority, lies and ego. The other is Good. Itâ€™s joy, kindness, empathy and truthâ€. The boy thought about it and asked â€œGran, which wolf wins?â€. The old man quietly replied â€œThe one you feedâ€.</p>
</blockquote>
<p><br></p>
<p>æœ€è¿‘çœ‹çœ‹javascriptåŸºç¡€çŸ¥è¯†ï¼Œä»Šå¤©æ¥ç²—æµ…çš„è°ˆè°ˆjavascripté‡Œå‡½æ•°ä½œç”¨åŸŸã€‚</p>
<p>è¯´åˆ°å‡½æ•°ä½œç”¨åŸŸï¼Œå°±ä¸å¾—ä¸æåˆ°é—­åŒ…ã€‚å­å‡½æ•°ä»»æ„è®¿é—®çˆ¶å‡½æ•°çš„å˜é‡ï¼Œå¹¶å¯¹å…¶é•¿æœŸæŒæœ‰ã€‚çˆ¶å‡½æ•°å¤–éƒ¨ä¸èƒ½è®¿é—®å†…éƒ¨å˜é‡ã€‚è¿™å°±æ˜¯é—­åŒ…ã€‚<br><a id="more"></a></p>
<p>ç›´æ¥ä¸Šä»£ç ï¼š</p>
<pre><code><span class="keyword">var</span> globalVariable = <span class="number">1</span>;
(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">var</span> localVariable = <span class="number">1</span>;
  <span class="keyword">this</span>.add = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
    localVariable += globalVariable;
    <span class="built_in">console</span>.log(localVariable);
  }
})();

add(); <span class="comment">// 2</span>
</code></pre><p>ä¸Šé¢çš„ä»£ç ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code><span class="list">(<span class="keyword">function</span><span class="list">()</span> <span class="collection">{ /* logic goes here */ }</span>)</span><span class="list">()</span><span class="comment">;</span>
</code></pre><p>ç¬¬ä¸€ä¸ªæ‹¬å·å†…å®šä¹‰äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ˆä»¥ä¸‹å«åšä¸€æ¬¡æ€§åŒ¿åå‡½æ•°ï¼‰ï¼Œç¬¬äºŒä¸ªæ‹¬å·çš„ä½œç”¨æ˜¯ç«‹å³æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚ä¸Šé¢ä»£ç ä¸­çš„thiså…¶å®æ˜¯æŒ‡å‘å¤–éƒ¨ç¯å¢ƒã€‚thisä¸ŠæŒ‚è½½äº†ä¸€ä¸ªaddå±æ€§ã€‚è¿™ä¸ªå±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå‡½æ•°å­—é¢é‡ã€‚ä¹Ÿå°±æ˜¯ä¸€æ¬¡æ€§åŒ¿åå‡½æ•°çš„å†…éƒ¨å‡½æ•°ã€‚ä¹‹å‰æåˆ°å­å‡½æ•°å¯ä»¥è®¿é—®çˆ¶å‡½æ•°å˜é‡å¹¶é•¿æœŸæŒæœ‰ã€‚å³ä½¿ä¸€æ¬¡æ€§åŒ¿åå‡½æ•°æ‰§è¡Œå®Œåè¢«å›æ”¶æ‰ï¼Œadd()ä»ç„¶æ˜¯å­˜åœ¨çš„ï¼ˆå› ä¸ºaddæ–¹æ³•æ˜¯æŒ‚è½½åœ¨å…¨å±€çš„ï¼‰ã€‚ç”±äºadd é•¿æœŸæŒæœ‰localVariableçš„å¼•ç”¨ã€‚æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡add() è®¿é—®localVariableï¼Œè¿™å°±å½¢æˆäº†é—­åŒ…ã€‚</p>
<h3 id="å®ä¾‹ï¼š">å®ä¾‹ï¼š</h3><p>åœ¨å®é™…é¡¹ç›®é‡Œï¼Œæˆ‘å°±é‡åˆ°äº†ä¸€ä¸ªç”±äºå˜é‡ä½œç”¨åŸŸå¯¼è‡´çš„é—®é¢˜ã€‚åº”ç”¨åœºæ™¯å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š<br>åœ¨ä¸€ä¸ªåœ°å›¾ä¸Šç”»ä¸€ä¸ªå¤šè¾¹å½¢ï¼Œæˆ‘æœ‰ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„é‡Œæ˜¯æ¯ä¸€ä¸ªå¯¹è±¡ä»£è¡¨åœ°å›¾ä¸Šå¤šè¾¹å½¢çš„æ¯ä¸ªæŠ˜ç‚¹ã€‚ç°åœ¨éœ€è¦ç»™æ¯ä¸€ä¸ªæŠ˜ç‚¹æ·»åŠ dragendäº‹ä»¶ï¼Œé¼ æ ‡æ‹–åŠ¨ç‚¹åˆ°æ–°çš„ä½ç½®æ—¶ï¼Œæ›´æ–°å¯¹è±¡æ•°ç»„ä¸­ç›¸åº”ç‚¹çš„ç»çº¬åº¦ä½ç½®ã€‚èµ·åˆæˆ‘æ˜¯è¿™ä¹ˆåšçš„ï¼š(æ³¨ï¼šä»¥ä¸‹ä»…æ˜¯ä¸€æ®µä¼ªä»£ç )</p>
<pre><code>Points = [pt1, pt2, pt3, pt4, pt5]
<span class="comment">//foreach Points as tmpPt, i</span>
<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;Points.length; i++) {
  <span class="keyword">var</span> tmpPt = Points[i];
  tmpPt.addEventListener(<span class="string">'dragend'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>{
      Points[i].latlng = e.lat + <span class="string">','</span> + e.lng;
  });
}
</code></pre><p>å¯æ˜¯æ‰§è¡Œçš„æ—¶å€™ï¼Œæ— è®ºæˆ‘æ”¹å˜å“ªä¸€ä¸ªç‚¹çš„ä½ç½®ï¼ŒPointsä¸­ç‚¹çš„ç»çº¬åº¦éƒ½æ²¡æœ‰å˜åŒ–ã€‚è¿™æ˜¯å› ä¸ºå½“æˆ‘ç»™æ¯ä¸ªç‚¹æ³¨å†Œäº†äº‹ä»¶åï¼Œå¾ªç¯ç»“æŸï¼Œiå·²ç»å˜æˆäº†Points.lengthã€‚dragendè§¦å‘åç¨‹åºè¯•å›¾ä¿®æ”¹Points[Points.length]ï¼ˆå…¶å®è¿™ä¸ªå¯¹è±¡æ ¹æœ¬å°±ä¸å­˜åœ¨ï¼‰ã€‚</p>
<p>è¿™é‡ŒçœŸæ­£éœ€è¦çš„æ˜¯åœ¨å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶èƒ½å¤Ÿå–å¾—è¯¥ç‚¹åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•å€¼ã€‚é‚£ä¹ˆå°±å¿…é¡»æŠŠæ¯æ¬¡å¾ªç¯é‡Œçš„iå˜æˆå›è°ƒå‡½æ•°çš„å†…éƒ¨å‚æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿé•¿æœŸæŒæœ‰ã€‚æˆ‘çš„åšæ³•æ˜¯ï¼š</p>
<pre><code>tmpPt.addEventListener(<span class="string">'dragend'</span>, (<span class="function"><span class="keyword">function</span><span class="params">(index)</span>{</span>
    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
        Points<span class="matrix">[index]</span>.latlng = e.lat + <span class="string">','</span> + e.lng;
    }
})(<span class="built_in">i</span>)
);
</code></pre><p>æ³¨å†Œdragendäº‹ä»¶æ˜¯ä¼šç«‹å³æ‰§è¡Œè¿™ä¸ªä¸€æ¬¡æ€§åŒ¿åå‡½æ•°ï¼ŒæŠŠæ¯æ¬¡å¾ªç¯é‡Œçš„iä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€æ¬¡æ€§æ‰§è¡Œå‡½æ•°ï¼Œæœ€åè¿”å›ä¸€ä¸ªfunction (è¿™ä¸ªè¿”å›çš„functionå°±æ˜¯å›è°ƒå‡½æ•°)ã€‚æ­¤æ—¶çš„iå°±æ˜¯ä¸€æ¬¡æ€§åŒ¿åå‡½æ•°çš„å†…éƒ¨å‚æ•°ã€‚è¿™é‡Œå½¢æˆäº†é—­åŒ…ã€‚æ— è®ºé¼ æ ‡æ‹–åŠ¨å“ªä¸ªç‚¹ï¼Œéƒ½èƒ½å¤Ÿåœ¨å›è°ƒå‡½æ•°ä¸­å¾—åˆ°æ­£ç¡®çš„ç´¢å¼•å€¼ã€‚</p>
<p>tips: å­¦ä¹ è¿‡ç¨‹ä¸­é¡ºä¾¿äº†è§£åˆ°äº†å‡½æ•°å®šä¹‰æ–¹æ³• var a = function(){} å’Œ function a(){} çš„åŒºåˆ«ã€‚ ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨å’ŒåŠŸèƒ½å®ç°éƒ½æ˜¯ä¸€è‡´çš„ã€‚åªæ˜¯functionè¯­å¥ï¼ˆå³åè€…ï¼‰åœ¨è§£ææ—¶ä¼šå‘ç”Ÿè¢«æå‡çš„æƒ…å†µã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºfunctionè¢«æ”¾ç½®åœ¨å“ªé‡Œï¼Œéƒ½ä¼šè¢«ç§»åŠ¨åˆ°æ‰€åœ¨ä½œç”¨åŸŸçš„é¡¶å±‚ã€‚</p>
<pre><code><span class="built_in">console</span>.log(getA); <span class="comment">// è¾“å‡ºç»“æœï¼š function getA()</span>
<span class="function"><span class="keyword">function</span> <span class="title">getA</span><span class="params">()</span></span>{
    <span class="keyword">return</span> <span class="string">'a'</span>;
}

<span class="built_in">console</span>.log(getB); <span class="comment">// è¾“å‡ºç»“æœï¼š undefined</span>
<span class="keyword">var</span> getB = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
    <span class="keyword">return</span> <span class="string">'B'</span>;
}
</code></pre><p>function getA(){â€¦}åœ¨è§£ææ—¶å°±ä¼šè¢«æåˆ°ä½œç”¨åŸŸé¡¶å±‚ã€‚ ä½†æ˜¯ä¸ºäº†ä¸å¯¼è‡´æ··ä¹±ï¼Œè¿˜æ˜¯å»ºè®®å¤§å®¶åœ¨å†™ä»£ç æ˜¯å…ˆå®šä¹‰å†è°ƒç”¨ã€‚</p>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="http://blog.csdn.net/pusongyang/article/details/7034904" target="_blank" rel="external">å†è°ˆJavascriptä¸­function fn(){}å’Œvar fn=function(){}</a></li>
<li>javascriptè¯­è¨€ç²¾ç²¹</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>An old Cherokee told his grandson â€œmy son, there is a battle between 2 wolves inside us all. One is Evil. It is anger, jealousy, greed, resentment, inferiority, lies and ego. The other is Good. Itâ€™s joy, kindness, empathy and truthâ€. The boy thought about it and asked â€œGran, which wolf wins?â€. The old man quietly replied â€œThe one you feedâ€.</p>
</blockquote>
<p><br></p>
<p>æœ€è¿‘çœ‹çœ‹javascriptåŸºç¡€çŸ¥è¯†ï¼Œä»Šå¤©æ¥ç²—æµ…çš„è°ˆè°ˆjavascripté‡Œå‡½æ•°ä½œç”¨åŸŸã€‚</p>
<p>è¯´åˆ°å‡½æ•°ä½œç”¨åŸŸï¼Œå°±ä¸å¾—ä¸æåˆ°é—­åŒ…ã€‚å­å‡½æ•°ä»»æ„è®¿é—®çˆ¶å‡½æ•°çš„å˜é‡ï¼Œå¹¶å¯¹å…¶é•¿æœŸæŒæœ‰ã€‚çˆ¶å‡½æ•°å¤–éƒ¨ä¸èƒ½è®¿é—®å†…éƒ¨å˜é‡ã€‚è¿™å°±æ˜¯é—­åŒ…ã€‚<br>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[What we lost?]]></title>
    <link href="http://yoursite.com/2015/08/13/What-we-lost/"/>
    <id>http://yoursite.com/2015/08/13/What-we-lost/</id>
    <published>2015-08-13T14:24:56.000Z</published>
    <updated>2015-08-13T14:31:32.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>In the age of acceleration, nothing can be more exhilarating than going slow. And in the age of distraction, nothing is so luxurious as paying attention. And in the age of constant movement, nothing is so urgent as sitting still.</p>
</blockquote>
<p>Technologe brings our life into a new stage of century. Everything is rising faster and faster. And it means to be used by saving time. But why we still feel lack of time, even more than before? What we lost when we are all rushing into the entire new age?</p>
<a id="more"></a>
<p>In this complete fast going world, we work longer, spending more time on social network instead of being with friends and family in real life. I canâ€™t belive technology is actually cutting off the connection between people. Itâ€™s hard to feel the surroundings with all your heart. And certainly, most of us, including me, read peopleâ€™s life through something called Internet, something called fackbook, wechat comment and other social apps. It, however, is huge waste of time. Because I donâ€™t need to read peopleâ€™s life but join it.</p>
<p>This is not the first time I feel that my life is going faster than I can be with. We all do. Since last year, while I was rushing into the future, all I heard in my head is noisy, the noisy from outside world. I was the most anxious,emotional painful than I ever felt, which brought me to the hell. I was crying a few times a day. without any reason. Everything that is happening can be the trigger to make me cry. My life was such a mess. I lost the inner peace. I lost the balance between inside and outside. There was nothing I can do to save my life until I went maditating again. What I found out is that the more I was emotional uncomfortable, the more concentrated I can be.</p>
<p>Maditating is slowing me down and preventing me from rushing into the furture. Technologe dose excellent work by improving work efficiency if itâ€™s used correctly. However, it also bring us the side effects of life. What technologe hasnâ€™t always given us is a sense of how to wisest use of technology. In return, it perhaps makes you more tired, confused instead.</p>
<p>This world is much more powerful, infomative. We all go too fast and want to take advantage of it. But on the other hand, it costs more on real personal life.  Itâ€™s hard to keep peace inside, thatâ€™s also exactly what outside world make us suffer by. Maybe the only way to keep ourselves, our sprits, survive from it is slowing down, feeling things around you with all your heart. The smile of people, the sounds of laughing, the sensation of touching things, and the feeling when you hug people etc.</p>
<p>Meditation ,for me, is not only about sitting down. When you do something with 100% concentration. You are being the present, you are meditating. Itâ€™s hard to explain how it changed me. And Iâ€™m still trying. But it works. It works well.</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>In the age of acceleration, nothing can be more exhilarating than going slow. And in the age of distraction, nothing is so luxurious as paying attention. And in the age of constant movement, nothing is so urgent as sitting still.</p>
</blockquote>
<p>Technologe brings our life into a new stage of century. Everything is rising faster and faster. And it means to be used by saving time. But why we still feel lack of time, even more than before? What we lost when we are all rushing into the entire new age?</p>]]>
    
    </summary>
    
      <category term="life" scheme="http://yoursite.com/tags/life/"/>
    
      <category term="meditation" scheme="http://yoursite.com/tags/meditation/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[gulpå­¦ä¹ åˆä½“éªŒ]]></title>
    <link href="http://yoursite.com/2015/06/21/gulp%E5%AD%A6%E4%B9%A0%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
    <id>http://yoursite.com/2015/06/21/gulpå­¦ä¹ åˆä½“éªŒ/</id>
    <published>2015-06-21T13:02:53.000Z</published>
    <updated>2015-06-21T16:05:37.000Z</updated>
    <content type="html"><![CDATA[<p>èŠ±äº†ä¸€å¤©çš„æ—¶é—´ï¼ŒæŠŠgulpçš„ä¸€äº›åŸºæœ¬ç”¨æ³•è¿‡äº†ä¸€éã€‚æ€»ç®—å¯¹å…¶æœ‰äº†äº›äº†è§£ã€‚è®°å½•ä¸‹å­¦ä¹ ä¸­çš„ä¸è§£ï¼Œä¹Ÿç®—å¯¹è¿™æ¬¡çš„å­¦ä¹ ä¸€ä¸ªæ€»ç»“ã€‚</p>
<p>é¦–å…ˆä»‹ç»ä¸€ä¸‹gulpï¼Œgulpæ˜¯ä¸€ä¸ªå‰ç«¯æ„å»ºå·¥å…·ï¼Œåˆ©ç”¨å®ƒå¯ä»¥åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­è‡ªåŠ¨åŒ–æ‰§è¡Œä»»åŠ¡ã€‚æœ‰èµ–äºå…¶å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨gulpå®Œæˆå¾ˆå¤šä»»åŠ¡ï¼Œä¾‹å¦‚æ‰§è¡ŒJSHintï¼Œç¼–è¯‘stylusï¼Œæ›´æ–°ç‰ˆæœ¬å·ç­‰ã€‚</p>
<a id="more"></a>
<h2 id="å®‰è£…gulpï¼š">å®‰è£…gulpï¼š</h2><p>å…¨å±€å®‰è£…ï¼š</p>
<pre><code>npm <span class="keyword">install</span> -g gulp
</code></pre><p>é¡¹ç›®å®‰è£…ï¼š</p>
<pre><code>npm install --<span class="built_in">save</span>-<span class="built_in">dev</span> gulp
</code></pre><p>â€”save-dev å®‰è£…åŒ…å°†åœ¨å¼€å‘ç¯å¢ƒä¸‹å®‰è£…ï¼Œç‰ˆæœ¬ä¿¡æ¯å†™å…¥package.jsonçš„devDependenciesä¸‹ã€‚</p>
<p>gulpä»»åŠ¡éƒ½å®šä¹‰åœ¨gulpfile.jsä¸­ï¼Œå¯ä»¥åœ¨ç»ˆç«¯è¿è¡Œgulpå‘½ä»¤æ¥æ‰§è¡Œã€‚</p>
<h2 id="gulpä»»åŠ¡">gulpä»»åŠ¡</h2><p>åŠ è½½gulpæ¨¡å—</p>
<pre><code><span class="reserved">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);
</code></pre><p>å…¶ä»–gulpæ’ä»¶çš„åŠ è½½ä¹Ÿæ˜¯ä¸€æ ·ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€æ®µç¼–è¯‘stylusçš„gulp taskä»£ç ï¼Œç”¨æ¥ç®€å•è§£é‡Šä¸€ä¸‹gulpçš„å·¥ä½œæµç¨‹ã€‚</p>
<pre><code>gulp.task(<span class="string">'stylus'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
  gulp.src(<span class="string">'./assets/stylus/style.styl'</span>)
      .pipe(stylus())
      .pipe(gulp.dest(<span class="string">'./assets/stylesheets'</span>));
});
</code></pre><p>gulp.task(taskName, excutor)ç”¨æ¥å®šä¹‰ä»»åŠ¡ã€‚éœ€è¦ä»»åŠ¡åå’Œæ‰§è¡Œå‡½æ•°ä¸¤ä¸ªå‚æ•°ã€‚æ‰§è¡Œå‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªä»»åŠ¡ã€‚</p>
<p>gulp.task(â€˜buildâ€™, [â€˜taskâ€™, â€˜anotherTaskâ€™]);</p>
<p>ä½†æ˜¯è¿™äº›ä»»åŠ¡ä¸æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚è¦ä¿è¯ä¸€ä¸ªä»»åŠ¡å…ˆäºå¦ä¸€ä¸ªæ‰§è¡Œå¯ä»¥ï¼š</p>
<pre><code>gulp.task(<span class="string">'taskTwo'</span>, [<span class="string">'taskOne'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
   <span class="comment">// taskTwo</span>
});
</code></pre><p>taskTwo ä¼šåœ¨ taskOneæ‰§è¡Œå®Œåå†æ‰§è¡Œã€‚</p>
<p>gulp.src()å‡½æ•°ç”¨æ¥åŒ¹é…æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡æµæ¥ä»£è¡¨è¿™äº›æ–‡ä»¶ï¼Œä¹‹åçš„æ“ä½œéƒ½æ˜¯ä»¥è¿™äº›æ–‡ä»¶ä¸ºå¯¹è±¡è¿›è¡Œæ“ä½œã€‚pipeé¡¾åæ€ä¹‰å°±æ˜¯ç®¡é“çš„æ„æ€ï¼Œ stylus()è¿”å›ä¿®æ”¹åçš„æ–‡ä»¶å¯¹è±¡æ”¾å…¥æµä¸­ï¼Œè¿™äº›è¾“å‡ºçš„æ–‡ä»¶éšç€ç®¡é“è¢«è¾“å…¥åˆ°gulp.dest()å‡½æ•°ä¸­å¹¶ä¿æŒä¸‹æ¥ã€‚</p>
<p>æœ€åä¸è¦å¿˜è®°åœ¨æ–‡ä»¶å¤´éƒ¨åŠ è½½gulp-stylusæ¨¡å—ã€‚</p>
<h2 id="è¿è¡Œgulp">è¿è¡Œgulp</h2><p>ç»ˆç«¯æ‰§è¡Œ <code>$ gulp</code> ä¼šæŠ¥é”™ï¼Œå› ä¸ºgulpé»˜è®¤ä¼šæ‰§è¡Œdefault ä»»åŠ¡ã€‚éœ€è¦åœ¨gulpfile.jså†…å®šä¹‰æ­¤ä»»åŠ¡</p>
<pre><code>gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
  <span class="comment">//deal with default task</span>
})
</code></pre><p>å¦‚æœè¦è¿è¡ŒæŒ‡å®šä»»åŠ¡</p>
<pre><code><span class="variable">$ </span>gulp taskName
</code></pre><h2 id="watching_files">watching files</h2><p>ç”¨gulpæ¥ç›‘å¬æ–‡ä»¶çš„ä¿®æ”¹çŠ¶æ€éå¸¸æ–¹ä¾¿ã€‚æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªwatchä»»åŠ¡çœ‹ä¸€ä¸‹</p>
<pre><code>gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
  gulp.watch(<span class="string">'./assets/stylus/*.styl'</span>, [<span class="string">'stylus'</span>]);
});
</code></pre><p>ç°åœ¨å½“æ”¹å˜stylæ–‡ä»¶æ—¶å°±ä¼šæ‰§è¡Œstylusä»»åŠ¡ã€‚</p>
<p>å½“ç„¶ä»…ä»…æ˜¯watchæ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›åœ¨æ–‡ä»¶ä¿®æ”¹çš„åŒæ—¶æµè§ˆå™¨èƒ½åŒæ­¥æ›´æ–°ã€‚browserSyncæ’ä»¶å°±å¯ä»¥åšåˆ°ã€‚å½“æ”¹å˜ä»£ç çš„æ—¶å€™ï¼ŒBrowserSyncä¼šé‡æ–°åŠ è½½é¡µé¢ï¼Œå¦‚æœæ˜¯cssæ–‡ä»¶ï¼Œä¼šç›´æ¥æ·»åŠ è¿›cssä¸­ï¼Œé¡µé¢å¹¶ä¸éœ€è¦å†æ¬¡åˆ·æ–°ã€‚è¿™æ ·æˆ‘ä»¬ä¿®æ”¹å‰ç«¯ä»£ç æ—¶å°±ä¸éœ€è¦æ¯æ¬¡éƒ½æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ã€‚</p>
<pre><code><span class="tag">gulp</span><span class="class">.task</span>(<span class="string">'browser-sync'</span>, <span class="function">function</span>(){
  <span class="tag">browserSync</span><span class="class">.init</span>(null, {
    <span class="attribute">proxy</span>: <span class="string">'http://localhost:3000'</span>,
    <span class="attribute">files</span>: [<span class="string">'assets/stylesheets/*.css'</span>],
    <span class="attribute">browser</span>: <span class="string">'google-chrome'</span>,
    <span class="attribute">port</span>: <span class="number">7000</span>,
    <span class="attribute">reloadOnRestart</span>: false
  });
});
<span class="tag">gulp</span><span class="class">.task</span>(<span class="string">'default'</span>, [<span class="string">'browser-sync'</span>]);
</code></pre><p>gulpè¿è¡Œæ—¶ä¼šé»˜è®¤æ‰§è¡Œbrowser-syncä»»åŠ¡ã€‚å¯åŠ¨browserSyncï¼Œç›‘å¬cssæ–‡ä»¶çš„æ”¹å˜å¹¶åœ¨chromeä¸­åŠ è½½æ›´æ–°çš„éƒ¨åˆ†ã€‚</p>
<blockquote>
<p> proxy: vhost url<br> files: ç›‘å¬æ”¹å˜çš„æ–‡ä»¶<br> port: browserä¾¦æµ‹æ”¹å˜çš„ç«¯å£</p>
</blockquote>
<p>browserSyncä¸»è¦ç›‘å¬æµè§ˆå™¨ç«¯çš„æ”¹å˜ï¼Œè¦ç›‘å¬æ›´æ–°æœåŠ¡ç«¯éœ€è¦ç”¨åˆ°nodemon</p>
<pre><code>gulp.task(<span class="string">'nodemon'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
  <span class="keyword">return</span> nodemon({
    script: <span class="string">'bin/www'</span>,
    ext: <span class="string">'js'</span>
  }).on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{

  });
});
</code></pre><p>é¡¹ç›®å¼€å‘æ˜¯åŸºäºexpressï¼Œ è¿™æ®µä»£ç ä¼šæ‰§è¡Œbin/wwwæ–‡ä»¶è¿è¡ŒæœåŠ¡ç«¯ï¼Œå¹¶ç›‘å¬jsæ–‡ä»¶çš„æ”¹å˜ï¼Œæ¯æ¬¡æ”¹å˜é‡å¯æœåŠ¡ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>èŠ±äº†ä¸€å¤©çš„æ—¶é—´ï¼ŒæŠŠgulpçš„ä¸€äº›åŸºæœ¬ç”¨æ³•è¿‡äº†ä¸€éã€‚æ€»ç®—å¯¹å…¶æœ‰äº†äº›äº†è§£ã€‚è®°å½•ä¸‹å­¦ä¹ ä¸­çš„ä¸è§£ï¼Œä¹Ÿç®—å¯¹è¿™æ¬¡çš„å­¦ä¹ ä¸€ä¸ªæ€»ç»“ã€‚</p>
<p>é¦–å…ˆä»‹ç»ä¸€ä¸‹gulpï¼Œgulpæ˜¯ä¸€ä¸ªå‰ç«¯æ„å»ºå·¥å…·ï¼Œåˆ©ç”¨å®ƒå¯ä»¥åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­è‡ªåŠ¨åŒ–æ‰§è¡Œä»»åŠ¡ã€‚æœ‰èµ–äºå…¶å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨gulpå®Œæˆå¾ˆå¤šä»»åŠ¡ï¼Œä¾‹å¦‚æ‰§è¡ŒJSHintï¼Œç¼–è¯‘stylusï¼Œæ›´æ–°ç‰ˆæœ¬å·ç­‰ã€‚</p>]]>
    
    </summary>
    
      <category term="front-end" scheme="http://yoursite.com/tags/front-end/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[åŒçº¿éƒ¨ç½²é‡åˆ°çš„é—®é¢˜]]></title>
    <link href="http://yoursite.com/2015/05/03/%E5%8F%8C%E7%BA%BF%E9%83%A8%E7%BD%B2%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2015/05/03/åŒçº¿éƒ¨ç½²é‡åˆ°çš„é—®é¢˜/</id>
    <published>2015-05-03T07:23:20.000Z</published>
    <updated>2015-05-09T15:35:26.000Z</updated>
    <content type="html"><![CDATA[<p>æœ¬æ¥åšå®¢æ˜¯æ”¾åœ¨githubä¸Šé¢ï¼Œä½†æ˜¯ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒï¼ˆå¤§å®¶æ‡‚çš„ï¼‰ï¼Œgithubè®¿é—®ä¸æ˜¯å¾ˆç¨³å®šï¼Œéšæ—¶è¢«æŸ¥æ°´è¡¨ã€‚æ‰€ä»¥é‡‡å–ç½‘å‹çš„å»ºè®®ï¼Œåœ¨gitcafeä¹Ÿéƒ¨ç½²ä¸€ä¸ªã€‚gifcafeæ˜¯å›½å†…çš„ï¼Œé€Ÿåº¦æ æ çš„ï½</p>
<a id="more"></a>
<p>è¿™æ ·å›½å†…è®¿é—®èµ°gitcafeï¼Œå›½å¤–è®¿é—®èµ°githubï¼Œå†åšä¸ªdnspodåŒçº¿è§£æå°±å¤§åŠŸå‘Šæˆã€‚</p>
<p>ä¸‹é¢çºªå½•é‡æ–°åŒçº¿éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œä½œå­¦ä¹ ä¹‹ç”¨ã€‚</p>
<p>hexoéƒ¨ç½²å•ä¸ªå¹³å°æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ·»åŠ ä¸€ä¸ªgitcafeï¼Œå†deployå°±æŠ¥é”™äº†ã€‚</p>
<blockquote>
<p>deploy:<br>- type: git<br>  repository: github url<br>  branch: master<br>- type: git<br>  repository: gitcafe url<br>  branch: gitcafe-pages</p>
</blockquote>
<p>githubå¯ä»¥æ­£å¸¸deployï¼ŒgitcafeæŠ¥é”™ï¼špermission deniedã€‚ æˆ‘æƒ³åº”è¯¥æ˜¯ç”Ÿæˆçš„ssh keyå‡ºäº†é—®é¢˜ã€‚</p>
<p>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ssh keyï¼Œ ä¸ºäº†é¿å…æ²¡é”™è¿æ¥åˆ°githubæˆ–gitcafeéƒ½è¦è¾“å…¥å¯†ç ï¼Œå¯ä»¥ç”¨é‚®ä»¶åœ°å€åœ¨æœ¬åœ°ç”Ÿæˆid_rsa å’Œ id_rsa.pubï¼Œå‰è€…æ˜¯ç§é’¥è‡ªå·±ä¿å­˜ï¼Œåè€…æ˜¯å…¬é’¥éœ€è¦æ·»åŠ åˆ°githubå’Œgitcafeï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡è¿æ¥éƒ½è¾“å…¥å¯†ç åšèº«ä»½éªŒè¯äº†ã€‚å…³äºssh keyçš„ç”Ÿæˆè¯·æˆ³<a href="https://help.github.com/articles/generating-ssh-keys/" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<p>æˆ‘ä¹‹å‰æ˜¯é’ˆå¯¹githubå’Œgitcafeåˆ†åˆ«ç”Ÿæˆäº†id_rsa,id_rsa.pubå’Œcafe_rsaå’Œcafe_rsa.pubã€‚</p>
<p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œè¿™ä¹ˆå¤šç§é’¥sshä¸çŸ¥é“åº”è¯¥ç”¨å“ªä¸€ä¸ªã€‚å…¶å®~/.ssh/id_rsaæ˜¯åŸºæœ¬ç§é’¥ï¼Œsshæ€»æ˜¯æŠŠå®ƒå½“ä½œæäº¤ç§é’¥çš„é¦–é€‰é¡¹ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨å…¶ä»–çš„ç§é’¥ï¼Œå°±éœ€è¦å‘sshæåŠï¼Œå¥½åƒç™»è®°æ ·ï¼Œå¹¶ä¸”é…ç½®~/.sshä¸‹configæ–‡ä»¶æ¥æŒ‡å®šä¸åŒhoståº”è¯¥ä½¿ç”¨çš„ç§é’¥æ–‡ä»¶ã€‚å…·ä½“çœ‹ä¸‹é¢ï¼š</p>
<pre><code>ssh-<span class="keyword">add</span> ~/.ssh/cafe_rsa
</code></pre><p>æ£€æŸ¥æ˜¯å¦æ·»åŠ æˆåŠŸï¼š</p>
<pre><code>ssh-<span class="keyword">add</span> -l
</code></pre><p>å¦‚æœæ˜¯è¿™æ ·å°±æˆåŠŸäº†ï¼š</p>
<blockquote>
<p>2048 dc:0f:0d:5b:â€¦:a0:0b:a7:d3:62:a6:bc:bc /Users/username/.ssh/id_rsa (RSA)<br>2048 d8:2c:1c:25:â€¦:56:14:c7:79:7e:20:43:20 /Users/username/.ssh/cafe_rsa (RSA)</p>
</blockquote>
<p>configæ–‡ä»¶çš„é…ç½®ï¼š</p>
<blockquote>
<p>Host username.github.com<br>HostName github.com<br>User git<br>IdentityFile ~/.ssh/id_rsa</p>
<p>Host username.gitcafe.com<br>HostName gitcafe.com<br>User git<br>IdentityFile ~/.ssh/cafe_rsa</p>
</blockquote>
<p>åŒç†ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¹³å°æœ‰å¤šä¸ªç”¨æˆ·ï¼Œåªéœ€è¦æ·»åŠ ç›¸åŒçš„é¡¹å¹¶ä¿®æ”¹Hostçš„usernameå°±è¡Œäº†ï½</p>
<p>ä½†æ˜¯æˆ‘æƒ³åŒæ—¶ç”Ÿæˆé‚£ä¹ˆå¤škeyä¹Ÿä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥å–æ¶ˆäº†cafe_rsa,ç›´æ¥æŠŠid_rsa.pubä½œä¸ºgithubå’Œgitcafeçš„ssh keyã€‚è¿™æ ·ä¸¤ä¸ªå¹³å°å°±å…¬ç”¨ä¸€ä¸ªæœ¬åœ°ç§é’¥ã€‚ä¹Ÿä¸ç”¨å†å»è®¾ç½®ä»€ä¹ˆconfigæ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”Ÿæˆå¯†é’¥çš„é‚®ç®±å’Œæˆ‘githubï¼Œgitcafeçš„é‚®ç®±æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å†ä¿®æ”¹ä¸€ä¸‹hexoçš„_config.ymlæ–‡ä»¶ï¼š</p>
<blockquote>
<p>deploy:<br> type: git<br> repository:<br>   github: git@username.github.com:username/username.github.io.git,[branch]<br>   gitcafe: git@username.gitcafe.com:username/username.git,[branch]</p>
</blockquote>
<p>è¿™ä¸‹å°±å¯ä»¥åŒæ—¶å¯¹ä¸¤ä¸ªå¹³å°è¿›è¡Œéƒ¨ç½²ï¼Œå°½æƒ…å‘å¸ƒäº†ï½</p>
<h6 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h6><ul>
<li><a href="http://wshuyi.github.io/2014/08/22/hexoGithubGitCafe20140822/" target="_blank" rel="external">åœ¨githubå’Œgitcafeä¸ŠåŒæ—¶éƒ¨ç½²hexoåšå®¢</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>æœ¬æ¥åšå®¢æ˜¯æ”¾åœ¨githubä¸Šé¢ï¼Œä½†æ˜¯ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒï¼ˆå¤§å®¶æ‡‚çš„ï¼‰ï¼Œgithubè®¿é—®ä¸æ˜¯å¾ˆç¨³å®šï¼Œéšæ—¶è¢«æŸ¥æ°´è¡¨ã€‚æ‰€ä»¥é‡‡å–ç½‘å‹çš„å»ºè®®ï¼Œåœ¨gitcafeä¹Ÿéƒ¨ç½²ä¸€ä¸ªã€‚gifcafeæ˜¯å›½å†…çš„ï¼Œé€Ÿåº¦æ æ çš„ï½</p>]]>
    
    </summary>
    
      <category term="issue" scheme="http://yoursite.com/tags/issue/"/>
    
      <category term="tech" scheme="http://yoursite.com/tags/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[setup Macbook]]></title>
    <link href="http://yoursite.com/2015/05/02/setup-Macbook/"/>
    <id>http://yoursite.com/2015/05/02/setup-Macbook/</id>
    <published>2015-05-02T15:35:56.000Z</published>
    <updated>2015-05-03T09:11:04.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨</p>
</blockquote>
<p>æŠ˜è…¾äº†ä¸¤å¤©ï¼Œç»ˆäºæŠŠæ–°åˆ°æ‰‹çš„Macbook å„ç§é…ç½®å¥½ï¼ ä¸­é—´é‡åˆ°çš„é—®é¢˜ä¸æ˜¯ä¸€èˆ¬ä¸¤èˆ¬çš„å¤šï¼Œè°å«æˆ‘æ˜¯æ–°æ‰‹å‘¢ï¼ï¼ï¼</p>
<a id="more"></a>
<h2 id="å¼€å‘">å¼€å‘</h2><p>æœ€å¼€å§‹çš„å¼€å§‹ï¼Œå½“ç„¶æ˜¯xcodeäº†ï¼Œå¾ˆå¤šå®‰è£…éƒ½éœ€è¦xcode ready firstã€‚</p>
<ul>
<li><p>Homebrewï¼š å¾ˆå¥½ç”¨çš„åŒ…ç®¡ç†å·¥å…·ï¼ŒåæœŸå®‰è£…ä¸€äº›åº”ç”¨ã€æ’ä»¶ä¹‹ç±»çš„å¾ˆæ–¹ä¾¿ã€‚</p>
</li>
<li><p>Iterm2 \ï¼‹ zsh: æˆ‘çš„æœ€çˆ±ï¼Œå¼ºå¤§çš„ç»ˆç«¯ã€‚<br><img src="https://iterm2.com/img/screenshots/split_panes_full.png" alt="Iterm2"><br>æ–°æ‰‹çœ‹èµ·æ¥ç¬é—´é«˜å¤§ä¸Šæœ‰æœ¨æœ‰ï½</p>
</li>
<li><p>Gitï¼š å¥¹çš„ç¾ä¸è¨€è€Œå–»ã€‚</p>
</li>
<li><p>Node.jsï¼š æœ‰å¥½å¤šä¸œè¥¿è¦å­¦ï¼Œå…ˆæŠ“nodeã€‚</p>
</li>
<li><p>NPMï¼š Nodeçš„åŒ…ç®¡ç†ç³»ç»Ÿï¼Œå®‰è£…å¾ˆæ–¹ä¾¿ï½</p>
<ul>
<li><p>gulpï¼š npmå®‰è£…åŒ…ã€‚</p>
</li>
<li><p>bowerï¼š å¦ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šåŒ…ç®¡ç†å·¥å…·ï½</p>
</li>
</ul>
</li>
</ul>
<h2 id="è®¾è®¡">è®¾è®¡</h2><p>Macæ€ä¹ˆèƒ½æ²¡æœ‰è®¾è®¡è½¯ä»¶æ¥é…æˆã€‚</p>
<ul>
<li><p>Adobe Photoshop CC</p>
</li>
<li><p>Adobe Lightroom (optional)</p>
</li>
<li><p>Adobe Illustrator (optional)</p>
</li>
<li><p>Sketch (optional)</p>
</li>
</ul>
<h2 id="ç½‘ç»œ">ç½‘ç»œ</h2><p>æœ€åå½“ç„¶å°‘ä¸äº†ç©¿è¶Šï¼Œä½ ä»¬æ‡‚å¾—ï½</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨</p>
</blockquote>
<p>æŠ˜è…¾äº†ä¸¤å¤©ï¼Œç»ˆäºæŠŠæ–°åˆ°æ‰‹çš„Macbook å„ç§é…ç½®å¥½ï¼ ä¸­é—´é‡åˆ°çš„é—®é¢˜ä¸æ˜¯ä¸€èˆ¬ä¸¤èˆ¬çš„å¤šï¼Œè°å«æˆ‘æ˜¯æ–°æ‰‹å‘¢ï¼ï¼ï¼</p>]]>
    
    </summary>
    
      <category term="Mac" scheme="http://yoursite.com/tags/Mac/"/>
    
      <category term="front-end" scheme="http://yoursite.com/tags/front-end/"/>
    
  </entry>
  
</feed>