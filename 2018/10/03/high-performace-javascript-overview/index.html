<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.2"/>




  <meta name="keywords" content="javascript," />



  <link rel="alternate" href="/atom.xml" title="Angelina ZX" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.2" />




  <title> high performace javascript overview // Angelina ZX </title>
</head>

<body>
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <!--<i class="icon-logo"></i>-->
      </span>
      <span class="site-title">Angelina ZX</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
     
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <!--//<i class="menu-item-icon icon-home"></i> <br />-->
          Home
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <!--//<i class="menu-item-icon icon-archives"></i> <br />-->
          Archives
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <!--//<i class="menu-item-icon icon-tags"></i> <br />-->
          Tags
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              high performace javascript overview
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on 2018-10-03
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2018/10/03/high-performace-javascript-overview/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/10/03/high-performace-javascript-overview/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <p>最近看完了高性能javascript，粗略的回顾一下各章知识点。由于看到是英文原版，有些翻译成中文的内容可能不太准确，附上原文做参考。<br>因为这本书是2010年写的，很多内容不适合当代浏览器，比如第四章讲到的循环算法Duff’s Device， 实测在chrome浏览器中不适用。还有文末提到的构建工具和性能测试工具，都很旧了，所以谨慎参考。</p>
<a id="more"></a>
<h2 id="Chapter_1:_the_most_optimal_ways_to_load_javascript">Chapter 1: the most optimal ways to load javascript</h2><p>Browsers don’t start rendering on the page until the opening <body> tag is encountered.<br>Every time a <code>&lt;script&gt;</code> tag is encountered, the page must stop and wait for the code to download and execute before continuing to process the rest of the page. UI 渲染和js代码不能同时运行，所以js代码运行时一定会阻塞ui更新。</body></p>
<h3 id="Chapter_1_Summary">Chapter 1 Summary</h3><ul>
<li>尽量把所有<code>&lt;script&gt;</code> 标签放在<code>&lt;/body&gt;</code>前面，让页面在js代码执行前尽可能的渲染</li>
<li>合并js代码，尽量少地加载<code>&lt;script&gt;</code></li>
</ul>
<h2 id="Chapter_2_-_8:_specific_programming_techniques_to_help_js_code_run_faster">Chapter 2 - 8: specific programming techniques to help js code run faster</h2><h2 id="Chapter_2:_Data_Access">Chapter 2: Data Access</h2><p>数据的存放位置会影响到对数据内容的读写速度。此外数据的访问速度还与所处的作用域有关。作用域链从最前面到最末尾分别是：本地作用域（当前执行环境的作用域）、外层执行环境作用域、一次类推最后是全局环境作用域。访问变量越靠近作用域链前端，访问速度越快。</p>
<h3 id="4种数据在代码中的存放">4种数据在代码中的存放</h3><ul>
<li><p>字面值 (literal value): 经代表自身没有被赋值给其他任何东西。如’some string’, 27, true/false, null, undefined, {a: 1, b: 2}, [1,2,3], 匿名函数等等</p>
</li>
<li><p>存在变量中 (variables): 被赋值给变量。如<code>var str = &#39;some string&#39;;</code>, <code>var obj = {a: 1, b: 2}</code>, <code>var arr = [1,3,2]</code></p>
</li>
<li><p>存在数组成员中 (array items): 存放在数组的索引下。 如<code>arr[0], arr[1]</code></p>
</li>
<li><p>存在对象成员中 (object members): 存放在对象属性下。如<code>obj.a, ob[&#39;b&#39;]</code></p>
</li>
</ul>
<h3 id="Chapter_2_Summary">Chapter 2 Summary</h3><ul>
<li><p>相同作用域内访问速度：字面值 &gt; 变量 &gt; 数组成员 &gt; 对象成员。 数组成员以数字作为索引相对会比对象成员访问更快。</p>
</li>
<li><p>数据所处作用域越靠近作用域链前端，访问速度越快</p>
</li>
<li><p>避免使用with，高效实用catch（实用统一的handlerError方法去处理错误，避免在catch内部又过多的数据读写）。</p>
<p>with和try-catch的catch都会加长作用域链（会动态创建一个新的variable object并加到scope chain的最前端）。高效的js擎会只需要通过静态分析就能确定每个变量、函数的作用域，进而确定哪些变量可以在任意时刻被访问。这种作用域也称为静态作用域。可以加速数据的访问。with和catch都是在代码运行时创建作用域，属于动态作用域。无法仅通过静态技术实现，会导致运行时对变量的访问退回到传统访问方式。以下是书中原文：</p>
<blockquote>
<p>Optimizing JavaScript engines such as Safari’s Nitro try to speed up identifier resolution by analyzing the code to determine which variables should be accessible at any given time. These engines try to avoid the traditional scope chain lookup by indexing identifiers for faster resolution. When a dynamic scope is involved, however, this optimization is no longer valid. The engines need to switch back to a slower hash-based approach for identifier resolution that more closely mirrors traditional scope chain lookup</p>
</blockquote>
</li>
<li><p>嵌套对象成员的访问会对性能产生重大影下，应尽可能少的使用</p>
</li>
<li><p>属性、方法在原型链的位置越深，访问越慢</p>
</li>
<li><p>可通过将常用对象、数组、外部变量缓存为局部变量的做法提高访问效率。但是注意最好不要将对象方法存为局部变量，因为对象方法内部可能使用了this关键字，缓存最想方法可能会导致this指向变化。</p>
</li>
</ul>
<h2 id="Chapter_3:_DOM_scripting">Chapter 3: DOM scripting</h2><h3 id="DOM">DOM</h3><p>文档对象模型是一个独立于语言的，对XML和HTML文档进行操作的应用程序接口（API）。DOM API在浏览器中的接口是通过javascript实现的。</p>
<h3 id="为什么操作DOM会带来性能损耗？">为什么操作DOM会带来性能损耗？</h3><blockquote>
<p>Simply having two separate pieces of functionality interfacing with each other will always come at a cost.</p>
</blockquote>
<p>原文中对此有一个比喻，我觉得非常形象：</p>
<blockquote>
<p>An excellent analogy is to think of DOM as a piece of land and JavaScript (meaning ECMAScript) as another piece of land, both connected with a toll bridge. Every time your ECMAScript needs access to the DOM, you have to cross this bridge and pay the performance toll fee. The more you work with the DOM, the more you pay.</p>
</blockquote>
<h3 id="重排和重绘">重排和重绘</h3><p>浏览器并在并解析完所有的文件（html, js, css, 图片资源等），会创建两个内部数据结构：</p>
<ul>
<li><p>DOM 树：表示页面结构，包含所有显示和隐藏的节点（隐藏节点可能是注释、<code>&lt;script&gt;</code>、display为none的元素等）</p>
</li>
<li><p>渲染树：表示页面是如何渲染的，包含所有需要显示在页面的节点<br>树构造完毕开始绘制页面元素</p>
</li>
</ul>
<h4 id="重排">重排</h4><p>DOM元素的几何属性（宽高）发生变化，甚至影响到其他元素的大小和位置。导致浏览器需要重构受影响部分的渲染树，这个过程叫重排。</p>
<h4 id="重绘">重绘</h4><p>重排完成后重新绘制受影响的部分叫重绘。注意几何属性发生变化才会导致重排，backgound color这种变化仅仅导致重绘</p>
<h4 id="导致重排的场景">导致重排的场景</h4><ul>
<li>添加、删除可见元素</li>
<li>元素position变化</li>
<li>元素尺寸变化（width/height/padding/border/margin, etc）</li>
<li>元素内容变化</li>
<li>第一次渲染时</li>
<li>window resize</li>
</ul>
<h4 id="批量修改DOM如何减少重排、重绘">批量修改DOM如何减少重排、重绘</h4><p>原理：先将元素从文档流移除，应用修改，重新插入元素</p>
<ul>
<li><p><strong>使用document fragment，应用修改，插入片段。注意像文档添加document fragment，实际添加的是片段内部的所有子节点群，而不会添加片段本身</strong>。</p>
<p><strong>最推荐这个方法，因为它涉及最少数量的重排和重绘</strong></p>
</li>
<li><p>隐藏元素(display: none)，应用修改， 显示元素（display）</p>
</li>
<li>克隆原始节点、克隆修改、覆盖原始节点</li>
</ul>
<h3 id="Chapter_3_Summary">Chapter 3 Summary</h3><ul>
<li><p>最小化DOM访问，让javascript做尽可能多的事</p>
</li>
<li><p>使用局部变量存储高频访问的dom引用</p>
</li>
<li><p>谨慎处理HTML collections（如document.getElementsByClass的返回值），如someCollection.length会实时返回集合的长度，总是给出最新的值。HTML collections are alive.</p>
</li>
<li><p>使用速度更快的api，如querySelectorAll(), firstElementChild等</p>
</li>
<li><p>浏览器通过队列存放修改内容最后批量修改的方式减少重排次数，但是对布局信息的访问会导致立即重排。尽量减少对布局信息的查询次数</p>
</li>
<li><p>通过绝对定位将必要元素提出文档流，减小渲染树重构面积</p>
</li>
<li><p>使用事件委托</p>
<p>元素与event handler之间的关联也是有代价的（关联元素与event handler占用处理时间和浏览器保存handler记录占用内存）。使用时间委托最小化handler数量</p>
</li>
</ul>
<h2 id="Chapter_4:_Algorithms_and_Flow_Control_（算法和流程控制）">Chapter 4: Algorithms and Flow Control （算法和流程控制）</h2><p>这一章中的一些知识点对于现代浏览器并不适用。比如作者提出的处理大量循环时使用的Duff’s Device算法在现代chrome中并不能提高效率，反而比for循环更慢。 所以本章只对常用技巧进行总结。</p>
<h3 id="Chapter_4_Summary">Chapter 4 Summary</h3><ul>
<li><p>for, while, do-while效率差不多，但是比forEach等方法快。</p>
</li>
<li><p>逆序循环比正序效率更高</p>
</li>
</ul>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="built_in">len</span> = arr.length</span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>, j = <span class="built_in">len</span></span><br><span class="line">/* 正序 执行步骤</span><br><span class="line">  <span class="number">1.</span> 读取i</span><br><span class="line">  <span class="number">2.</span> 读取<span class="built_in">len</span></span><br><span class="line">  <span class="number">3.</span> 比较(i&lt;<span class="built_in">len</span>)</span><br><span class="line">  <span class="number">4.</span> 判断比较结果（<span class="literal">true</span>/<span class="literal">false</span>)</span><br><span class="line">  <span class="number">5.</span> 如果<span class="literal">true</span>，console.<span class="built_in">log</span></span><br><span class="line">  <span class="number">6.</span> i++, 回到第<span class="number">1</span>步</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">while</span>(i &lt; <span class="built_in">len</span>) &#123;</span><br><span class="line">  console.<span class="built_in">log</span>(arr[i])</span><br><span class="line">  i++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 逆序 执行步骤</span><br><span class="line">  <span class="number">1.</span> 读取j</span><br><span class="line">  <span class="number">2.</span> 判断j是否非<span class="number">0</span></span><br><span class="line">  <span class="number">3.</span> 如果非<span class="number">0</span>，j--</span><br><span class="line">  <span class="number">4.</span> console.<span class="built_in">log</span>, 返回第<span class="number">1</span>步</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">while</span>(j--) &#123;</span><br><span class="line">  console.<span class="built_in">log</span>(arr[j])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>除非遍历属性未知的对象，避免使用for-in loop</p>
</li>
<li><p>改善循环效率的方法：减少迭代次数； 减少每次迭代中的运算量</p>
</li>
<li><p>判断条件较多时使用lookup table比if-else或switch更快</p>
</li>
<li><p>浏览器的调用栈（call stack）尺寸会限制递归算法的应用，可使用迭代代替</p>
</li>
<li><p>使用memoization减少重复工作</p>
<p>通过缓存先前计算结果方便后续计算再利用。有效减少重复工作，尤其在递归中。<br>原文解释：</p>
<blockquote>
<p>Memoization is an approach to avoid work repetition by caching previous calculations for later reuse, which makes memoization a useful technique for recursive algorithms.</p>
</blockquote>
<p>两段代码解释Memoization算法：</p>
</li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function factorial(<span class="keyword">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">n</span> == 0) &#123;</span><br><span class="line">    <span class="keyword">return</span> 1;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">n</span> * factorial(<span class="keyword">n</span>-1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fact6 = factorial(6); <span class="comment">//加上factorial(6)本身，factorial被调用了7次</span></span><br><span class="line"><span class="keyword">var</span> fact5 = factorial(5); <span class="comment">// 调用了6次</span></span><br><span class="line"><span class="keyword">var</span> fact4 = factorial(4); <span class="comment">// 调用了5次</span></span><br></pre></td></tr></table></figure>
<p>改进后<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function factorial(<span class="keyword">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!factorial.cache) &#123;</span><br><span class="line">    factorial.cache = &#123;</span><br><span class="line">      <span class="string">"0"</span>: 1,</span><br><span class="line">      <span class="string">"1"</span>: 1</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!factorial.cache.hasOwnProperty(<span class="keyword">n</span>)) &#123;</span><br><span class="line">    factorial.cache[<span class="keyword">n</span>] = <span class="keyword">n</span> * factorial (<span class="keyword">n</span>-1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> factorial.cache[<span class="keyword">n</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Chapter_5:_String_and_Regular_Expressions">Chapter 5: String and Regular Expressions</h2><h3 id="Chapter_5_Summary:">Chapter 5 Summary:</h3><ul>
<li><p>计算速度： + 、 += &gt; array.join</p>
</li>
<li><p>正则表达式相关的内容及其匹配原理我觉得是另一个全新的话题了。它的回溯（backtracking）查找使其基本组成部分，也是影响效率的因素。有兴趣的可以去理解一下正则匹配的原理。</p>
</li>
<li><p>关于space trimming，文中内容过于老化（作者提了一些编程方法来修正字符串），不适用如现代javascript。现在js中完全可以用String.prototype.trim实现。</p>
</li>
</ul>
<h2 id="Chapter_6:_Responsive_Interfaces_响应接口">Chapter 6: Responsive Interfaces 响应接口</h2><p>Javscript和用户界面更新在同一个进程下运行，所以js运行时会阻塞页面响应，反之亦然。因此确保javascript不会运行太长时间阻塞用户与页面交互，影响用户体验。</p>
<p>下面这段代码说明js运行对ui的阻塞，<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html</span></span><br><span class="line">&lt;input id=<span class="string">"textInput"</span> <span class="keyword">class</span>=<span class="string">"custom"</span> size=<span class="string">"32"</span>&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">    Browser Event Loop:</span><br><span class="line">    step1: execute all tasks in stack</span><br><span class="line">    -&gt; step2: execute all micro tasks</span><br><span class="line">    -&gt; step3: render UI</span><br><span class="line">    -&gt; step4: execute first macro task</span><br><span class="line">    -&gt; back to step2 - step4 until no more macro task then start new round of Event Loop</span><br><span class="line"></span><br><span class="line">    Note:</span><br><span class="line">    javasript execution will definitly prevent UI rendering. Cause javascript is single process.</span><br><span class="line">    It can either update UI or execute js one at a time. The way to free up UI rendering is to put js</span><br><span class="line">    code into macro task queue such as use a timer function</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">(e)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'gonna sleep'</span>);</span><br><span class="line">  sleep(<span class="number">5000</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'awake'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">(duration)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ui won's update until code bellow done execution</span></span><br><span class="line">    <span class="keyword">let</span> time1 = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">let</span> time2</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        time2 = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    &#125; <span class="keyword">while</span>(time2 - time1 &lt; duration)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// code bellow won't prevent ui update</span></span><br><span class="line"><span class="comment">//     setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//         console.log('timer done')</span></span><br><span class="line"><span class="comment">//     &#125;, duration)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.querySelector(<span class="string">'#textInput'</span>)</span><br><span class="line">input.addEventListener(<span class="string">'input'</span>, test)</span><br></pre></td></tr></table></figure>
<p>向input输入‘a’，会执行test，js运行阻塞了ui更新，所以等待5秒后ui才会更新，所以用户输入’a’的头5s是没有看到页面有任何变化的。</p>
<h3 id="Chapter_6_Summary">Chapter 6 Summary</h3><ul>
<li><p>javascript不应该运行超过100ms，过长时间导致ui更新出现可察觉的延迟，影响用户体验。</p>
</li>
<li><p>timer（即定时器，eg. setTimeout）可用于安排代码推迟执行。使得可以将长运行脚本分解成较小任务。</p>
</li>
<li><p>Web Worker允许在ui线程外运行js，避免锁定ui。</p>
</li>
<li><p>用户体验是最重要的，越大型的项目越要有效管理ui线程。</p>
</li>
</ul>
<h2 id="Chapter_7:_Ajax">Chapter 7: Ajax</h2><p>这部分内容我觉得也是比较旧了，总结一些常用的：</p>
<h3 id="Chapter_7_Summary">Chapter 7 Summary</h3><ul>
<li><p>减少请求数量。网络请求都存在网络时延（这句是我自己加的）</p>
</li>
<li><p>友好处理错误，不要直接显示给用户</p>
</li>
</ul>
<h2 id="Chapter_8:_Programming_Practice">Chapter 8: Programming Practice</h2><p>这一章讲了一些通用技巧来优化js性能</p>
<h3 id="Chapter_8_Summary">Chapter 8 Summary</h3><ul>
<li><p>避免使用eval和new Function()避免二次评估，另外给setTimeout和setInterval传递函数作为参数而不是传递字符串。</p>
<p>这四个函数允许传入一串包含代码的字符串作为参数，js运行时会首先将代码当成正常代码执行，然后运行时会发生另一次评估，运行字符串中的代码。二次评估的代价昂贵，会占用更长时间。</p>
</li>
<li><p>创建对象、数组是使用字面量，比使用他们的构造函数初始化更快</p>
</li>
<li><p>避免重复工作，尽量使用延迟加载(lazy loading)或条件加载(conditional loading)</p>
</li>
<li><p>执行数学运算时，考虑使用位运算符，它直接在数字底层进行操作，运算更快</p>
<p>位运算的使用场景</p>
<ol>
<li>常规数学计算<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>)</span><br><span class="line"><span class="keyword">if</span> (i % <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'even'</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'odd'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>)</span><br><span class="line"><span class="keyword">if</span> (i &amp; <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'odd'</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'even'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>位掩码技术（bitmask): 可以同时判断多过选项返回布尔值，或者创建一个数字包含多个选项<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> cat1</span> = <span class="number">1</span> <span class="comment">// 代表 'food' - 二进制 01</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> cat2</span> = <span class="number">2</span> <span class="comment">//'fruit' - 二进制 10</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> cat3</span> = <span class="number">4</span> <span class="comment">//'vegetable' - 二进制 100</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> cat4</span> = <span class="number">8</span> <span class="comment">//'beverage' - 二进制 1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对二进制位做或操作，其结果其实和cat1 + cat2相同，只是位运算更快</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> appleIs</span> = cat1 &amp; cat2 <span class="comment">// 二进制码 11</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 位掩码</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> isAppleFood</span> = appleIs &amp; cat1 <span class="comment">// 11 &amp; 01 --&gt; 01 与cat1的值相等，非零表示为true</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> isAppleFruuit</span> = appleIs &amp; cat2 <span class="comment">// 11 &amp; 10 --&gt; 10 与cat2的值相等</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> isAppleVege</span> = appleIs &amp; cat3 <span class="comment">// 011 &amp; 100 --&gt; 000 即0</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>原生方法运行更快，尽量使用原生方法</p>
</li>
</ul>
<h2 id="Chapter_9:_the_best_to_build_&amp;_deploy_js_files">Chapter 9: the best to build &amp; deploy js files</h2><p>本章介绍了javscript构建和部署过程的基本知识，还给出了一些工具及用法，但过于陈旧不适合不适合现代前端构件流程。只记录一些基本知识。</p>
<h3 id="Chapter_9_Summar">Chapter 9 Summar</h3><ul>
<li>构件流程的基本步骤：<ul>
<li>合并js文件，尽可能减少<code>&lt;script&gt;</code>的使用</li>
<li>压缩文件</li>
<li>以压缩形式（gzip）提供js文件</li>
<li>配置缓存</li>
<li>使用CDN提高性能</li>
</ul>
</li>
</ul>
<h2 id="Chapter_10:_performance_tools_that_help_identify_further_issues">Chapter 10: performance tools that help identify further issues</h2><p>本章介绍了一些javascript的性能测试工具。其中有一些工具已经过时，而且我没有全部研究过上面提到的工具，对于个人使用的性能分析工具有自己的喜好（eg. Chrome Audit），所以这一章略过。</p>

      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/javascript/"> #javascript </a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/10/27/Chrome-devtools-工作原理/">Chrome devtools 工作原理</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/10/JStimezone/">Javascript 时间时区大杂烩</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    
      <div class="comments" id="comments">
        
          <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </div>
        
      </div>
    
  </div>


        </div>
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table Of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="http://wx.qlogo.cn/mmopen/LPLYlyQ5GAohFKvwFs1KuqrwPBECNF4vbuGgpX2oopuXwG4Zia5ia8wRGp4C6feibTllVJl6suV6QiarGKIk6eh7PSsXTboRSyGm/0" alt="Angelina ZX" />
          <p class="site-author-name">Angelina ZX</p>
        </div>
        <p class="site-description motion-element"></p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">categories</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </div>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml">
              <i class="menu-item-icon icon-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/angelina999990" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://www.facebook.com/angelina.zhang3" target="_blank">Facebook</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://twitter.com/angelina999990" target="_blank">Twitter</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.douban.com/people/angelina999990/" target="_blank">DouBan</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://www.quora.com/Xue-Zhang-1" target="_blank">Quora</a>
            </span>
            
          
        </div>

        
        

      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_1:_the_most_optimal_ways_to_load_javascript"><span class="nav-number">1.</span> <span class="nav-text">Chapter 1: the most optimal ways to load javascript</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_1_Summary"><span class="nav-number">1.1.</span> <span class="nav-text">Chapter 1 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_2_-_8:_specific_programming_techniques_to_help_js_code_run_faster"><span class="nav-number">2.</span> <span class="nav-text">Chapter 2 - 8: specific programming techniques to help js code run faster</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_2:_Data_Access"><span class="nav-number">3.</span> <span class="nav-text">Chapter 2: Data Access</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4种数据在代码中的存放"><span class="nav-number">3.1.</span> <span class="nav-text">4种数据在代码中的存放</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_2_Summary"><span class="nav-number">3.2.</span> <span class="nav-text">Chapter 2 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_3:_DOM_scripting"><span class="nav-number">4.</span> <span class="nav-text">Chapter 3: DOM scripting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DOM"><span class="nav-number">4.1.</span> <span class="nav-text">DOM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么操作DOM会带来性能损耗？"><span class="nav-number">4.2.</span> <span class="nav-text">为什么操作DOM会带来性能损耗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重排和重绘"><span class="nav-number">4.3.</span> <span class="nav-text">重排和重绘</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#重排"><span class="nav-number">4.3.1.</span> <span class="nav-text">重排</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重绘"><span class="nav-number">4.3.2.</span> <span class="nav-text">重绘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#导致重排的场景"><span class="nav-number">4.3.3.</span> <span class="nav-text">导致重排的场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#批量修改DOM如何减少重排、重绘"><span class="nav-number">4.3.4.</span> <span class="nav-text">批量修改DOM如何减少重排、重绘</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_3_Summary"><span class="nav-number">4.4.</span> <span class="nav-text">Chapter 3 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_4:_Algorithms_and_Flow_Control_（算法和流程控制）"><span class="nav-number">5.</span> <span class="nav-text">Chapter 4: Algorithms and Flow Control （算法和流程控制）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_4_Summary"><span class="nav-number">5.1.</span> <span class="nav-text">Chapter 4 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_5:_String_and_Regular_Expressions"><span class="nav-number">6.</span> <span class="nav-text">Chapter 5: String and Regular Expressions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_5_Summary:"><span class="nav-number">6.1.</span> <span class="nav-text">Chapter 5 Summary:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_6:_Responsive_Interfaces_响应接口"><span class="nav-number">7.</span> <span class="nav-text">Chapter 6: Responsive Interfaces 响应接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_6_Summary"><span class="nav-number">7.1.</span> <span class="nav-text">Chapter 6 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_7:_Ajax"><span class="nav-number">8.</span> <span class="nav-text">Chapter 7: Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_7_Summary"><span class="nav-number">8.1.</span> <span class="nav-text">Chapter 7 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_8:_Programming_Practice"><span class="nav-number">9.</span> <span class="nav-text">Chapter 8: Programming Practice</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_8_Summary"><span class="nav-number">9.1.</span> <span class="nav-text">Chapter 8 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_9:_the_best_to_build_&_deploy_js_files"><span class="nav-number">10.</span> <span class="nav-text">Chapter 9: the best to build & deploy js files</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter_9_Summar"><span class="nav-number">10.1.</span> <span class="nav-text">Chapter 9 Summar</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chapter_10:_performance_tools_that_help_identify_further_issues"><span class="nav-number">11.</span> <span class="nav-text">Chapter 10: performance tools that help identify further issues</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2019
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Angelina ZX</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.content img').each(function () {
        var $image = $(this);
        var $imageWrapLink = $image.parent('a');

        if ($imageWrapLink.size() < 1) {
          $imageWrapLink = $image.wrap('<a href="' + this.getAttribute('src') + '"></a>').parent('a');
        }
        $imageWrapLink.addClass('fancybox');
      });
    });
    $('.fancybox').fancybox({
      helpers: {
        overlay: {
          locked: false
        }
      }
    });
  </script>


  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.logo-line-before i'), p: { translateX: "100%" }, o: { duration: 500, sequenceQueue: false } },
        { e: $('.logo-line-after i'), p: { translateX: "-100%" }, o: { duration: 500, sequenceQueue: false } },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  
  
<script type="text/javascript" id="bootstrap.scrollspy.custom">
  /* ========================================================================
  * Bootstrap: scrollspy.js v3.3.2
  * http://getbootstrap.com/javascript/#scrollspy
  * ========================================================================
  * Copyright 2011-2015 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  * ======================================================================== */

  /**
   * Custom by iissnan
   *
   * - Add a `clear.bs.scrollspy` event.
   * - Esacpe targets selector.
   */


  +function ($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body          = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector       = (this.options.target || '') + ' .nav li > a'
      this.offsets        = []
      this.targets        = []
      this.activeTarget   = null
      this.scrollHeight   = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION  = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function () {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function () {
      var that          = this
      var offsetMethod  = 'offset'
      var offsetBase    = 0

      this.offsets      = []
      this.targets      = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase   = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function () {
          var $el   = $(this)
          var href  = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href
            && $href.length
            && $href.is(':visible')
            && [[$href[offsetMethod]().top + offsetBase, href]]) || null
        })
        .sort(function (a, b) { return a[0] - b[0] })
        .each(function () {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function () {
      var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets      = this.offsets
      var targets      = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy')  // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i]
          && scrollTop >= offsets[i]
          && (!offsets[i + 1] || scrollTop <= offsets[i + 1])
          && this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function (target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function () {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy             = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function () {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function () {
      $('[data-spy="scroll"]').each(function () {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0 && isDesktop()) {
        setTimeout(function () {
          $('.sidebar-toggle').trigger('click');
        }, 800);
      }
    });
  </script>




  

  
  
  

  

    
      
    

    <script type="text/javascript">
      var disqus_shortname = 'angelinazx';
      var disqus_identifier = '2018/10/03/high-performace-javascript-overview/';
      var disqus_url = 'http://yoursite.com/2018/10/03/high-performace-javascript-overview/';

      (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  




  
</body>
</html>
